BX.namespace("BX.Sale.OrderAjaxComponent");
(function(){BX.Sale&&BX.Sale.Input&&BX.Sale.Input.Utils&&(BX.Sale.Input.Utils.asMultiple=function(a){if(void 0===a||null===a||""===a)return[];if(a.constructor===Array){for(var b=0,c=a.length,d;b<c;)d=a[b],void 0===d||null===d||""===d?(a.splice(b,1),--c):++b;return a.length?a:[""]}return[a]});BX.Sale.OrderAjaxComponent={initializePrimaryFields:function(){this.locationsInitialized=this.regionBlockNotEmpty=this.BXFormPosting=!1;this.locations={};this.cleanLocations={};this.locationsTemplate="";this.pickUpMapFocused=
!1;this.options={};this.activeSectionId="";this.firstLoad=!0;this.initialized={};this.mapsReady=!1;this.lastSelectedDelivery=0;this.deliveryLocationInfo={};this.deliveryPagination={};this.deliveryCachedInfo=[];this.paySystemPagination={};this.validation={};this.hasErrorSection={};this.pickUpPagination={};this.timeOut={};this.isMobile=BX.browser.IsMobile();this.isHttps="https:"===window.location.protocol;this.socServiceHiddenNode=this.orderSaveAllowed=!1},init:function(a){this.initializePrimaryFields();
this.result=a.result||{};this.prepareLocations(a.locations);this.params=a.params||{};this.signedParamsString=a.signedParamsString||"";this.siteId=a.siteID||"";this.ajaxUrl=a.ajaxUrl||"";this.templateFolder=a.templateFolder||"";this.defaultBasketItemLogo=this.templateFolder+"/images/product_logo.png";this.defaultStoreLogo=this.templateFolder+"/images/pickup_logo.png";this.defaultDeliveryLogo=this.templateFolder+"/images/delivery_logo.png";this.defaultPaySystemLogo=this.templateFolder+"/images/pay_system_logo.png";
this.orderBlockNode=BX(a.orderBlockId);this.totalBlockNode=BX(a.totalBlockId);this.mobileTotalBlockNode=BX(a.totalBlockId+"-mobile");this.savedFilesBlockNode=BX("bx-soa-saved-files");this.orderSaveBlockNode=BX("bx-soa-orderSave");this.mainErrorsNode=BX("bx-soa-main-notifications");this.authBlockNode=BX(a.authBlockId);this.authHiddenBlockNode=BX(a.authBlockId+"-hidden");this.basketBlockNode=BX(a.basketBlockId);this.basketHiddenBlockNode=BX(a.basketBlockId+"-hidden");this.regionBlockNode=BX(a.regionBlockId);
this.regionHiddenBlockNode=BX(a.regionBlockId+"-hidden");this.paySystemBlockNode=BX(a.paySystemBlockId);this.paySystemHiddenBlockNode=BX(a.paySystemBlockId+"-hidden");this.deliveryBlockNode=BX(a.deliveryBlockId);this.deliveryHiddenBlockNode=BX(a.deliveryBlockId+"-hidden");this.pickUpBlockNode=BX(a.pickUpBlockId);this.pickUpHiddenBlockNode=BX(a.pickUpBlockId+"-hidden");this.propsBlockNode=BX(a.propsBlockId);this.propsHiddenBlockNode=BX(a.propsBlockId+"-hidden");this.result.SHOW_AUTH&&(this.authBlockNode.style.display=
"",BX.addClass(this.authBlockNode,"bx-active"),this.authGenerateUser="Y"!==this.result.AUTH.new_user_registration_email_confirmation&&"Y"!==this.result.AUTH.new_user_phone_required);this.totalBlockNode&&(this.totalInfoBlockNode=this.totalBlockNode.querySelector(".bx-soa-cart-total"),this.totalGhostBlockNode=this.totalBlockNode.querySelector(".bx-soa-cart-total-ghost"));this.options.deliveriesPerPage=parseInt(a.params.DELIVERIES_PER_PAGE);this.options.paySystemsPerPage=parseInt(a.params.PAY_SYSTEMS_PER_PAGE);
this.options.pickUpsPerPage=parseInt(a.params.PICKUPS_PER_PAGE);this.options.showWarnings=!!a.showWarnings;this.options.propertyValidation=!!a.propertyValidation;this.options.priceDiffWithLastTime=!1;this.options.pickUpMap=a.pickUpMap;this.options.propertyMap=a.propertyMap;this.options.totalPriceChanged=!1;this.result.IS_AUTHORIZED&&"undefined"===typeof this.result.LAST_ORDER_DATA.FAIL||this.initFirstSection();this.initOptions();this.editOrder();this.bindEvents();this.orderBlockNode.removeAttribute("style");
this.basketBlockScrollCheck();"Y"===this.params.USE_ENHANCED_ECOMMERCE&&this.setAnalyticsDataLayer("checkout");"Y"===this.params.USER_CONSENT&&this.initUserConsent()},sendRequest:function(a,b){if(this.startLoader()){this.firstLoad=!1;a=BX.type.isNotEmptyString(a)?a:"refreshOrderAjax";var c={action:a,actionData:b,cancel:!1};BX.Event.EventEmitter.emit("BX.Sale.OrderAjaxComponent:onBeforeSendRequest",c);if(c.cancel)this.endLoader();else if("saveOrderAjax"===c.action){if(a=BX("bx-soa-order-form"))a.querySelector("input[type=hidden][name=sessid]").value=
BX.bitrix_sessid();BX.ajax.submitAjax(BX("bx-soa-order-form"),{url:this.ajaxUrl,method:"POST",dataType:"json",data:{via_ajax:"Y",action:"saveOrderAjax",sessid:BX.bitrix_sessid(),SITE_ID:this.siteId,signedParamsString:this.signedParamsString},onsuccess:BX.proxy(this.saveOrderWithJson,this),onfailure:BX.proxy(this.handleNotRedirected,this)})}else BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:this.getData(c.action,c.actionData),onsuccess:BX.delegate(function(d){d.redirect&&d.redirect.length&&
(document.location.href=d.redirect);this.saveFiles();switch(c.action){case "refreshOrderAjax":this.refreshOrder(d);break;case "confirmSmsCode":case "showAuthForm":this.firstLoad=!0;this.refreshOrder(d);break;case "enterCoupon":d&&d.order?(this.deliveryCachedInfo=[],this.refreshOrder(d)):this.addCoupon(d);break;case "removeCoupon":d&&d.order?(this.deliveryCachedInfo=[],this.refreshOrder(d)):this.removeCoupon(d)}BX.cleanNode(this.savedFilesBlockNode);this.endLoader()},this),onfailure:BX.delegate(function(){this.endLoader()},
this)})}},getData:function(a,b){var c={order:this.getAllFormData(),sessid:BX.bitrix_sessid(),via_ajax:"Y",SITE_ID:this.siteId,signedParamsString:this.signedParamsString};c[this.params.ACTION_VARIABLE]=a;if("enterCoupon"===a||"removeCoupon"===a)c.coupon=b;return c},getAllFormData:function(){var a=BX("bx-soa-order-form");a=BX.ajax.prepareForm(a);for(var b in a.data)a.data.hasOwnProperty(b)&&""==b&&delete a.data[b];return a&&a.data?a.data:{}},refreshOrder:function(a){a.error?(this.showError(this.mainErrorsNode,
a.error),this.animateScrollTo(this.mainErrorsNode,800,20)):a.order.SHOW_AUTH?(this.addAnimationEffect(this.authBlockNode,a.order.OK_MESSAGE&&a.order.OK_MESSAGE.length||a.order.SMS_AUTH&&"OK"===a.order.SMS_AUTH.TYPE?"bx-step-good":"bx-step-bad"),BX.merge(this.result,a.order),this.editAuthBlock(),this.showAuthBlock(),this.showErrors(a.order.ERROR,!1),this.animateScrollTo(this.authBlockNode)):(this.isPriceChanged(a),this.activeSectionId!==this.deliveryBlockNode.id&&(this.deliveryCachedInfo=[]),this.result=
a.order,this.prepareLocations(a.locations),this.pickUpMapFocused=this.maxWaitTimeExpired=this.locationsInitialized=!1,this.deliveryLocationInfo={},this.initialized={},this.clearHiddenBlocks(),this.initOptions(),this.editOrder(),this.mapsReady&&this.initMaps(),BX.saleOrderAjax&&BX.saleOrderAjax.initDeferredControl());return!0},saveOrderWithJson:function(a){var b=!1;a&&a.order&&(a=a.order,a.REDIRECT_URL?("Y"===this.params.USE_ENHANCED_ECOMMERCE&&this.setAnalyticsDataLayer("purchase",a.ID),(window.b24order=
window.b24order||[]).push({id:a.ID,sum:this.result.TOTAL.ORDER_PRICE}),b=!0,location.href=a.REDIRECT_URL):a.SHOW_AUTH?(this.result.SHOW_AUTH=a.SHOW_AUTH,this.result.AUTH=a.AUTH,this.result.SMS_AUTH=a.SMS_AUTH,this.editAuthBlock(),this.showAuthBlock(),this.animateScrollTo(this.authBlockNode)):this.showErrors(a.ERROR,!0,!0));b||this.handleNotRedirected()},handleNotRedirected:function(){this.endLoader();this.disallowOrderSave()},startLoader:function(){if(!0===this.BXFormPosting)return!1;this.BXFormPosting=
!0;this.loadingScreen||(this.loadingScreen=new BX.PopupWindow("loading_screen",null,{overlay:{backgroundColor:"white",opacity:1},events:{onAfterPopupShow:BX.delegate(function(){BX.cleanNode(this.loadingScreen.popupContainer);BX.removeClass(this.loadingScreen.popupContainer,"popup-window");this.loadingScreen.popupContainer.appendChild(BX.create("IMG",{props:{src:this.templateFolder+"/images/loader.gif"}}));this.loadingScreen.popupContainer.removeAttribute("style");this.loadingScreen.popupContainer.style.display=
"block"},this)}}),BX.addClass(this.loadingScreen.overlay.element,"bx-step-opacity"));this.loadingScreen.overlay.element.style.opacity="0";this.loadingScreen.show();this.loadingScreen.overlay.element.style.opacity="0.6";return!0},endLoader:function(){this.BXFormPosting=!1;this.loadingScreen&&this.loadingScreen.isShown()&&this.loadingScreen.close()},htmlspecialcharsEx:function(a){return a.replace(/&amp;/g,"&amp;amp;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/&quot;/g,"&amp;quot;").replace(/</g,
"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},saveFiles:function(){if(this.result.ORDER_PROP&&this.result.ORDER_PROP.properties){var a=this.result.ORDER_PROP.properties,b,c;for(b=0;b<a.length;b++)"FILE"==a[b].TYPE&&(c=this.orderBlockNode.querySelector('div[data-property-id-row="'+a[b].ID+'"]'))&&this.savedFilesBlockNode.appendChild(c)}},animateScrollTo:function(a,b,c){if(a){var d=BX.GetWindowScrollPos().scrollTop,e=BX.pos(this.orderBlockNode);a=BX.pos(a).top-(this.isMobile?50:0);c&&(a-=parseInt(c));
a+window.innerHeight>e.bottom&&(a=e.bottom-window.innerHeight+17);(new BX.easing({duration:b||800,start:{scroll:d},finish:{scroll:a},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate(function(f){window.scrollTo(0,f.scroll)},this)})).animate()}},checkKeyPress:function(a){if(13==a.keyCode){var b=a.target||a.srcElement;if(!b.getAttribute("data-send"))return(b=b.getAttribute("data-next"))&&(b=this.orderBlockNode.querySelector("input[name="+b+"]"))&&b.focus(),BX.PreventDefault(a)}},
getSizeString:function(a,b){a=parseInt(a);b=parseInt(b);return 1073741824<a?parseFloat(a/1073741824).toFixed(b)+" Gb":1048576<a?parseFloat(a/1048576).toFixed(b)+" Mb":1024<a?parseFloat(a/1024).toFixed(b)+" Kb":a+" B"},getFileAccepts:function(a){var b=[];a=a.split(",");var c,d={json:"application/json",javascript:"application/javascript","octet-stream":"application/octet-stream",ogg:"application/ogg",pdf:"application/pdf",zip:"application/zip",gzip:"application/gzip",aac:"audio/aac",mp3:"audio/mpeg",
gif:"image/gif",jpeg:"image/jpeg",png:"image/png",svg:"image/svg+xml",tiff:"image/tiff",css:"text/css",csv:"text/csv",html:"text/html",plain:"text/plain",php:"text/php",xml:"text/xml",mpeg:"video/mpeg",mp4:"video/mp4",quicktime:"video/quicktime",flv:"video/x-flv",doc:"application/msword",docx:"application/msword",xls:"application/vnd.ms-excel",xlsx:"application/vnd.ms-excel"};for(c=0;c<a.length;c++){var e=BX.util.trim(a[c]);e=d[e]||e;b.push(e)}return b.join(",")},uniqueText:function(a,b){var c,d=
[];b=b||"<br>";a=(a||"").split(b);a=BX.util.array_unique(a);for(c=0;c<a.length;c++)""!=a[c]&&d.push(BX.util.trim(a[c]));return d.join(b)},getImageSources:function(a,b){return a&&b&&a[b]?{src_1x:a[b+"_SRC"],src_2x:a[b+"_SRC_2X"],src_orig:a[b+"_SRC_ORIGINAL"]}:!1},getErrorContainer:function(a){a&&a.appendChild(BX.create("DIV",{props:{className:"alert alert-danger"},style:{display:"none"}}))},showError:function(a,b,c){BX.type.isArray(b)&&(b=b.join("<br>"));var d=a.querySelector(".alert.alert-danger");
d&&b.length&&(BX.cleanNode(d),d.appendChild(BX.create("DIV",{html:b})),(b=!this.hasErrorSection[a.id])?(d.style.opacity=0,d.style.display="",(new BX.easing({duration:300,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){d.style.opacity=e.opacity/100},complete:function(){d.removeAttribute("style")}})).animate()):d.style.display="",c&&BX.addClass(a,"bx-step-error"))},showErrors:function(a,b,c){var d=this.orderBlockNode.querySelectorAll("div.alert.alert-danger"),
e;for(e=0;e<d.length;e++){var f=BX.findParent(d[e],{className:"bx-soa-section"});BX.removeClass(f,"bx-step-error");d[e].style.display="none";BX.cleanNode(d[e])}if(a&&!(1>BX.util.object_keys(a).length)){for(e in a)if(a.hasOwnProperty(e))switch(d=a[e],e.toUpperCase()){case "MAIN":this.showError(this.mainErrorsNode,d);this.animateScrollTo(this.mainErrorsNode,800,20);b=!1;break;case "AUTH":"none"==this.authBlockNode.style.display?(this.showError(this.mainErrorsNode,d,!0),this.animateScrollTo(this.mainErrorsNode,
800,20),b=!1):this.showError(this.authBlockNode,d,!0);break;case "REGION":if(c||"true"===this.regionBlockNode.getAttribute("data-visited"))this.showError(this.regionBlockNode,d,!0),this.showError(this.regionHiddenBlockNode,d);break;case "DELIVERY":if(c||"true"===this.deliveryBlockNode.getAttribute("data-visited"))this.showError(this.deliveryBlockNode,d,!0),this.showError(this.deliveryHiddenBlockNode,d);break;case "PAY_SYSTEM":if(c||"true"===this.paySystemBlockNode.getAttribute("data-visited"))this.showError(this.paySystemBlockNode,
d,!0),this.showError(this.paySystemHiddenBlockNode,d);break;case "PROPERTY":if(c||"true"===this.propsBlockNode.getAttribute("data-visited"))this.showError(this.propsBlockNode,d,!0),this.showError(this.propsHiddenBlockNode,d)}b&&this.scrollToError()}},showBlockErrors:function(a){var b=a.querySelector("div.alert.alert-danger");if(b){BX.removeClass(a,"bx-step-error");b.style.display="none";BX.cleanNode(b);switch(a.id){case this.regionBlockNode.id:var c=this.regionHiddenBlockNode;var d=this.result.ERROR.REGION;
break;case this.deliveryBlockNode.id:c=this.deliveryHiddenBlockNode;d=this.result.ERROR.DELIVERY;break;case this.paySystemBlockNode.id:c=this.paySystemHiddenBlockNode;d=this.result.ERROR.PAY_SYSTEM;break;case this.propsBlockNode.id:c=this.propsHiddenBlockNode,d=this.result.ERROR.PROPERTY}d&&BX.util.object_keys(d).length&&(this.showError(a,d,!0),this.showError(c,d))}},checkNotifications:function(){var a=this.mainErrorsNode.querySelector('[data-type="informer"]'),b;if(a)if(this.firstLoad&&this.result.IS_AUTHORIZED&&
"undefined"===typeof this.result.LAST_ORDER_DATA.FAIL){var c=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active");c=(b=c.length&&"true"==c[c.length-1].getAttribute("data-visited"))?"success":"warning";b=(b?this.params.MESS_SUCCESS_PRELOAD_TEXT:this.params.MESS_FAIL_PRELOAD_TEXT).split("#ORDER_BUTTON#").join(this.params.MESS_ORDER);a.appendChild(BX.create("DIV",{props:{className:"row"},children:[BX.create("DIV",{props:{className:"col-xs-12"},style:{position:"relative"},children:[BX.create("DIV",
{props:{className:"icon-"+c}}),BX.create("DIV",{html:b})]})]}));BX.addClass(a,"alert alert-"+c);a.style.display=""}else if(BX.hasClass(a,"alert")){var d=BX.GetWindowScrollPos().scrollTop;var e=BX.pos(a);(new BX.easing({duration:300,start:{opacity:100},finish:{opacity:0},transition:BX.easing.transitions.linear,step:function(f){a.style.opacity=f.opacity/100},complete:function(){d>e.top&&window.scrollBy(0,-(e.height+20));a.style.display="none";BX.cleanNode(a);a.removeAttribute("class");a.removeAttribute("style")}})).animate()}},
checkPreload:function(a){switch(a.id){case this.regionBlockNode.id:a=this.result.LAST_ORDER_DATA&&this.result.LAST_ORDER_DATA.PERSON_TYPE;break;case this.paySystemBlockNode.id:a=this.result.LAST_ORDER_DATA&&this.result.LAST_ORDER_DATA.PAY_SYSTEM;break;case this.deliveryBlockNode.id:a=this.result.LAST_ORDER_DATA&&this.result.LAST_ORDER_DATA.DELIVERY;break;default:a=!0}return a},checkBlockErrors:function(a){var b,c;if(b=BX(a.id+"-hidden")){var d=(d=b.querySelector("div.alert.alert-danger"))&&"none"!=
d.style.display;var e=b.querySelector("div.alert.alert-warning.alert-show");if(!d)for(b=b.querySelectorAll("div.tooltip"),c=0;c<b.length;c++)if("opened"==b[c].getAttribute("data-state")){d=!0;break}}d?BX.addClass(a,"bx-step-error"):e?BX.addClass(a,"bx-step-warning"):BX.removeClass(a,"bx-step-error bx-step-warning");return!d},scrollToError:function(){var a=this.orderBlockNode.querySelectorAll("div.bx-soa-section.bx-active"),b,c;for(b in a)if(a.hasOwnProperty(b)&&(c=a[b].querySelector(".alert.alert-danger"))&&
"none"!=c.style.display){this.animateScrollTo(a[b]);break}},showWarnings:function(){var a=this.orderBlockNode.querySelectorAll("div.bx-soa-section.bx-active"),b=this.getSelectedDelivery(),c;for(c=0;c<a.length;c++)BX.removeClass(a[c],"bx-step-warning"),"false"==a[c].getAttribute("data-visited")&&BX.removeClass(a[c],"bx-step-completed");b&&b.CALCULATE_ERRORS?(BX.addClass(this.deliveryBlockNode,"bx-step-warning"),a="<strong>"+this.params.MESS_DELIVERY_CALC_ERROR_TITLE+"</strong>",this.params.MESS_DELIVERY_CALC_ERROR_TEXT.length&&
(a+="<br><small>"+this.params.MESS_DELIVERY_CALC_ERROR_TEXT+"</small>"),this.showBlockWarning(this.deliveryBlockNode,a),this.showBlockWarning(this.deliveryHiddenBlockNode,a),this.activeSectionId!=this.deliveryBlockNode.id&&(BX.addClass(this.deliveryBlockNode,"bx-step-completed"),BX.bind(this.deliveryBlockNode.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this)))):BX.hasClass(this.deliveryBlockNode,"bx-step-warning")&&this.activeSectionId!=this.deliveryBlockNode.id&&BX.removeClass(this.deliveryBlockNode,
"bx-step-warning");if(this.result.WARNING&&this.options.showWarnings)for(c in this.result.WARNING)if(this.result.WARNING.hasOwnProperty(c))switch(c.toUpperCase()){case "DELIVERY":"true"===this.deliveryBlockNode.getAttribute("data-visited")&&(this.showBlockWarning(this.deliveryBlockNode,this.result.WARNING[c],!0),this.showBlockWarning(this.deliveryHiddenBlockNode,this.result.WARNING[c],!0));break;case "PAY_SYSTEM":"true"===this.paySystemBlockNode.getAttribute("data-visited")&&(this.showBlockWarning(this.paySystemBlockNode,
this.result.WARNING[c],!0),this.showBlockWarning(this.paySystemHiddenBlockNode,this.result.WARNING[c],!0))}},notifyAboutWarnings:function(a){if(BX.type.isDomNode(a))switch(a.id){case this.deliveryBlockNode.id:this.showBlockWarning(this.deliveryBlockNode,this.result.WARNING.DELIVERY,!0);break;case this.paySystemBlockNode.id:this.showBlockWarning(this.paySystemBlockNode,this.result.WARNING.PAY_SYSTEM,!0)}},showBlockWarning:function(a,b,c){var d=a.querySelector(".alert.alert-danger"),e="",f;if(d){if(BX.type.isString(b))e=
b;else for(f in b)b.hasOwnProperty(f)&&b[f]&&(e+=b[f]+"<br>");if(e){b=a.querySelectorAll(".alert.alert-warning");for(f in b)if(b.hasOwnProperty(f)&&BX.type.isDomNode(b[f])&&-1!==b[f].innerHTML.indexOf(e))return;c=BX.create("DIV",{props:{className:"alert alert-warning"+(c?" alert-hide":" alert-show")},html:e});BX.prepend(c,d.parentNode);BX.addClass(a,"bx-step-warning")}}},showPagination:function(a,b){if(b&&a){var c=[],d;switch(a){case "delivery":var e=this.deliveryPagination;break;case "paySystem":e=
this.paySystemPagination;break;case "pickUp":e=this.pickUpPagination}if(1<e.pages.length){c.push(BX.create("LI",{attrs:{"data-action":"prev","data-entity":a},props:{className:"bx-pag-prev"},html:1==e.pageNumber?"<span>"+this.params.MESS_NAV_BACK+"</span>":'<a href=""><span>'+this.params.MESS_NAV_BACK+"</span></a>",events:{click:BX.proxy(this.doPagination,this)}}));for(d=0;d<e.pages.length;d++){var f=parseInt(d)+1;var g=f==e.pageNumber?"bx-active":"";c.push(BX.create("LI",{attrs:{"data-action":f,"data-entity":a},
props:{className:g},html:'<a href=""><span>'+f+"</span></a>",events:{click:BX.proxy(this.doPagination,this)}}))}c.push(BX.create("LI",{attrs:{"data-action":"next","data-entity":a},props:{className:"bx-pag-next"},html:e.pageNumber==e.pages.length?"<span>"+this.params.MESS_NAV_FORWARD+"</span>":'<a href=""><span>'+this.params.MESS_NAV_FORWARD+"</span></a>",events:{click:BX.proxy(this.doPagination,this)}}));a=this.params.TEMPLATE_THEME||"";c=BX.create("DIV",{props:{className:"bx-pagination"+(a?" bx-"+
a:"")},children:[BX.create("DIV",{props:{className:"bx-pagination-container"},children:[BX.create("UL",{children:c})]})]});b.appendChild(BX.create("DIV",{style:{clear:"both"}}));b.appendChild(c)}}},doPagination:function(a){var b=a.target||a.srcElement,c="LI"==b.tagName?b:BX.findParent(b,{tagName:"LI"});b=c.getAttribute("data-action");var d=c.getAttribute("data-entity");if(BX.hasClass(c,"bx-active"))return BX.PreventDefault(a);if("prev"==b||"next"==b)c=parseInt(BX.findParent(c).querySelector(".bx-active").getAttribute("data-action")),
b="next"==b?++c:--c;"delivery"==d?this.showDeliveryItemsPage(b):"paySystem"==d?this.showPaySystemItemsPage(b):"pickUp"==d&&this.showPickUpItemsPage(b);return BX.PreventDefault(a)},showDeliveryItemsPage:function(a){this.getCurrentPageItems("delivery",a);a=this.getSelectedDelivery();var b;a&&a.ID&&((b=this.deliveryBlockNode.querySelector("input[type=hidden][name=DELIVERY_ID]"))||(b=BX.create("INPUT",{props:{type:"hidden",name:"DELIVERY_ID",value:a.ID}})));a=this.deliveryBlockNode.querySelector(".bx-soa-pp-item-container");
BX.cleanNode(a);BX.type.isDomNode(b)&&BX.prepend(b,BX.findParent(a));for(b=0;b<this.deliveryPagination.currentPage.length;b++){var c=this.createDeliveryItem(this.deliveryPagination.currentPage[b]);a.appendChild(c)}this.showPagination("delivery",a)},showPaySystemItemsPage:function(a){this.getCurrentPageItems("paySystem",a);a=this.getSelectedPaySystem();var b;a&&a.ID&&((b=this.paySystemBlockNode.querySelector("input[type=hidden][name=PAY_SYSTEM_ID]"))||(b=BX.create("INPUT",{props:{type:"hidden",name:"PAY_SYSTEM_ID",
value:a.ID}})));a=this.paySystemBlockNode.querySelector(".bx-soa-pp-item-container");BX.cleanNode(a);BX.type.isDomNode(b)&&BX.prepend(b,BX.findParent(a));for(b=0;b<this.paySystemPagination.currentPage.length;b++){var c=this.createPaySystemItem(this.paySystemPagination.currentPage[b]);a.appendChild(c)}this.showPagination("paySystem",a)},showPickUpItemsPage:function(a){this.getCurrentPageItems("pickUp",a);this.editPickUpList(!1)},getCurrentPageItems:function(a,b){if(a&&"undefined"!==typeof b){switch(a){case "delivery":var c=
this.deliveryPagination;var d=this.options.deliveriesPerPage;break;case "paySystem":c=this.paySystemPagination;d=this.options.paySystemsPerPage;break;case "pickUp":c=this.pickUpPagination,d=this.options.pickUpsPerPage}c&&0<d&&!(0>=b||b>c.pages.length)&&(c.pageNumber=b,c.currentPage=c.pages.slice(c.pageNumber-1,c.pageNumber)[0])}},initPropsListForLocation:function(){if(BX.saleOrderAjax&&this.result.ORDER_PROP&&this.result.ORDER_PROP.properties){var a,b;BX.saleOrderAjax.cleanUp();for(a=0;a<this.result.ORDER_PROP.properties.length;a++){var c=
this.result.ORDER_PROP.properties[a];if("LOCATION"==c.TYPE&&"Y"==c.MULTIPLE&&"Y"!=c.IS_LOCATION)for(b=0;b<this.locations[c.ID].length;b++)BX.saleOrderAjax.addPropertyDesc({id:c.ID+"_"+b,attributes:{id:c.ID+"_"+b,type:c.TYPE,valueSource:"DEFAULT"==c.SOURCE?"default":"form"}});else b={id:c.ID,type:c.TYPE,valueSource:"DEFAULT"==c.SOURCE?"default":"form"},!this.deliveryLocationInfo.city&&0<parseInt(c.INPUT_FIELD_LOCATION)&&(b.altLocationPropId=parseInt(c.INPUT_FIELD_LOCATION),this.deliveryLocationInfo.city=
c.INPUT_FIELD_LOCATION),this.deliveryLocationInfo.loc||"Y"!=c.IS_LOCATION||(this.deliveryLocationInfo.loc=c.ID),this.deliveryLocationInfo.zip||"Y"!=c.IS_ZIP||(b.isZip=!0,this.deliveryLocationInfo.zip=c.ID),BX.saleOrderAjax.addPropertyDesc({id:c.ID,attributes:b})}}},bindEvents:function(){BX.bind(this.orderSaveBlockNode.querySelector("[data-save-button]"),"click",BX.proxy(this.clickOrderSaveAction,this));BX.bind(window,"scroll",BX.proxy(this.totalBlockScrollCheck,this));BX.bind(window,"resize",BX.throttle(function(){this.totalBlockResizeCheck();
this.alignBasketColumns();this.basketBlockScrollCheck();this.mapsReady&&this.resizeMapContainers()},50,this));BX.addCustomEvent("onDeliveryExtraServiceValueChange",BX.proxy(this.sendRequest,this))},initFirstSection:function(){var a=this.orderBlockNode.querySelector(".bx-soa-section.bx-active");BX.addClass(a,"bx-selected");this.activeSectionId=a.id},initOptions:function(){var a;this.initPropsListForLocation();this.propertyCollection=new BX.Sale.PropertyCollection(BX.merge({publicMode:!0},this.result.ORDER_PROP));
this.fadedPropertyCollection=new BX.Sale.PropertyCollection(BX.merge({publicMode:!0},this.result.ORDER_PROP));this.options.propertyValidation&&this.initValidation();this.initPagination();this.options.showPreviewPicInBasket=!1;this.options.showDetailPicInBasket=!1;this.options.showPropsInBasket=!1;this.options.showPriceNotesInBasket=!1;if(this.result.GRID&&this.result.GRID.HEADERS){var b=this.result.GRID.HEADERS;for(a=0;a<b.length;a++)"PREVIEW_PICTURE"===b[a].id&&(this.options.showPreviewPicInBasket=
!0),"DETAIL_PICTURE"===b[a].id&&(this.options.showDetailPicInBasket=!0),"PROPS"===b[a].id&&(this.options.showPropsInBasket=!0),"NOTES"===b[a].id&&(this.options.showPriceNotesInBasket=!0)}this.result.TOTAL&&(b=this.result.TOTAL,this.options.showOrderWeight=b.ORDER_WEIGHT&&0<parseFloat(b.ORDER_WEIGHT),this.options.showPriceWithoutDiscount=parseFloat(b.ORDER_PRICE)<parseFloat(b.PRICE_WITHOUT_DISCOUNT_VALUE),this.options.showDiscountPrice=b.DISCOUNT_PRICE&&0<parseFloat(b.DISCOUNT_PRICE),this.options.showTaxList=
b.TAX_LIST&&b.TAX_LIST.length,this.options.showPayedFromInnerBudget=b.PAYED_FROM_ACCOUNT_FORMATED&&b.PAYED_FROM_ACCOUNT_FORMATED.length)},reachGoal:function(a,b){var c=this.params.YM_GOALS_COUNTER||"";"Y"==this.params.USE_YM_GOALS&&"undefined"!==typeof window["yaCounter"+c]&&(a=this.getGoalId(a,b),window["yaCounter"+c].reachGoal(a))},getGoalId:function(a,b){if(!a)return"";if("initialization"==a)return this.params.YM_GOALS_INITIALIZE;if("order"==a)return this.params.YM_GOALS_SAVE_ORDER;var c="";a=
"edit"==a;if(!b||!b.id)return"";switch(b.id){case this.basketBlockNode.id:c=a?this.params.YM_GOALS_EDIT_BASKET:this.params.YM_GOALS_NEXT_BASKET;break;case this.regionBlockNode.id:c=a?this.params.YM_GOALS_EDIT_REGION:this.params.YM_GOALS_NEXT_REGION;break;case this.paySystemBlockNode.id:c=a?this.params.YM_GOALS_EDIT_PAY_SYSTEM:this.params.YM_GOALS_NEXT_PAY_SYSTEM;break;case this.deliveryBlockNode.id:c=a?this.params.YM_GOALS_EDIT_DELIVERY:this.params.YM_GOALS_NEXT_DELIVERY;break;case this.pickUpBlockNode.id:c=
a?this.params.YM_GOALS_EDIT_PICKUP:this.params.YM_GOALS_NEXT_PICKUP;break;case this.propsBlockNode.id:c=a?this.params.YM_GOALS_EDIT_PROPERTIES:this.params.YM_GOALS_NEXT_PROPERTIES}return c},isPriceChanged:function(a){a=null===a.order.TOTAL.ORDER_TOTAL_LEFT_TO_PAY?a.order.TOTAL.ORDER_TOTAL_PRICE:a.order.TOTAL.ORDER_TOTAL_LEFT_TO_PAY;this.options.totalPriceChanged=parseFloat(null===this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY||""===this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY?this.result.TOTAL.ORDER_TOTAL_PRICE:
this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY)!=parseFloat(a)},initValidation:function(){if(this.result.ORDER_PROP&&this.result.ORDER_PROP.properties){var a=this.result.ORDER_PROP.properties,b={},c;for(c in a)a.hasOwnProperty(c)&&(b[a[c].ID]=a[c]);this.validation.properties=b}},initPagination:function(){var a;if(this.result.DELIVERY)if(this.result.DELIVERY=this.getDeliverySortedArray(this.result.DELIVERY),0<this.options.deliveriesPerPage&&this.result.DELIVERY.length>this.options.deliveriesPerPage){var b=
this.result.DELIVERY.slice();var c=Math.ceil(b.length/this.options.deliveriesPerPage);var d=[];for(a=0;a<c;a++)d.push(b.splice(0,this.options.deliveriesPerPage));this.deliveryPagination.pages=d;for(a=0;a<this.result.DELIVERY.length;a++)if("Y"==this.result.DELIVERY[a].CHECKED){this.deliveryPagination.pageNumber=Math.ceil(++a/this.options.deliveriesPerPage);break}this.deliveryPagination.pageNumber=this.deliveryPagination.pageNumber||1;this.deliveryPagination.currentPage=d.slice(this.deliveryPagination.pageNumber-
1,this.deliveryPagination.pageNumber)[0];this.deliveryPagination.show=!0}else this.deliveryPagination.pageNumber=1,this.deliveryPagination.currentPage=this.result.DELIVERY,this.deliveryPagination.show=!1;if(this.result.PAY_SYSTEM)if(0<this.options.paySystemsPerPage&&this.result.PAY_SYSTEM.length>this.options.paySystemsPerPage){b=this.result.PAY_SYSTEM.slice();c=Math.ceil(b.length/this.options.paySystemsPerPage);d=[];for(a=0;a<c;a++)d.push(b.splice(0,this.options.paySystemsPerPage));this.paySystemPagination.pages=
d;for(a=0;a<this.result.PAY_SYSTEM.length;a++)if("Y"==this.result.PAY_SYSTEM[a].CHECKED){this.paySystemPagination.pageNumber=Math.ceil(++a/this.options.paySystemsPerPage);break}this.paySystemPagination.pageNumber=this.paySystemPagination.pageNumber||1;this.paySystemPagination.currentPage=d.slice(this.paySystemPagination.pageNumber-1,this.paySystemPagination.pageNumber)[0];this.paySystemPagination.show=!0}else this.paySystemPagination.pageNumber=1,this.paySystemPagination.currentPage=this.result.PAY_SYSTEM,
this.paySystemPagination.show=!1},initPickUpPagination:function(){var a=!1,b=!1,c,d;if(0<=this.options.pickUpsPerPage&&this.result.DELIVERY)for(d=0;d<this.result.DELIVERY.length;d++)if("Y"===this.result.DELIVERY[d].CHECKED&&this.result.DELIVERY[d].STORE_MAIN){b=0<this.result.DELIVERY[d].STORE_MAIN.length;a=this.result.DELIVERY[d].STORE_MAIN.length>this.options.pickUpsPerPage;b&&(c=this.getPickUpInfoArray(this.result.DELIVERY[d].STORE_MAIN));break}if(b)if(0<this.options.pickUpsPerPage&&a){a=c.slice();
b=Math.ceil(a.length/this.options.pickUpsPerPage);var e=[];for(d=0;d<b;d++)e.push(a.splice(0,this.options.pickUpsPerPage));this.pickUpPagination.pages=e;for(d=0;d<c.length;d++)if(!this.result.BUYER_STORE||c[d].ID==this.result.BUYER_STORE){this.pickUpPagination.pageNumber=Math.ceil(++d/this.options.pickUpsPerPage);break}this.pickUpPagination.pageNumber||(this.pickUpPagination.pageNumber=1);this.pickUpPagination.currentPage=e.slice(this.pickUpPagination.pageNumber-1,this.pickUpPagination.pageNumber)[0];
this.pickUpPagination.show=!0}else this.pickUpPagination.pageNumber=1,this.pickUpPagination.currentPage=c,this.pickUpPagination.show=!1},prepareLocations:function(a){this.locations={};this.cleanLocations={};var b,c;if(BX.util.object_keys(a).length)for(b in a)if(a.hasOwnProperty(b)){this.locationsTemplate=a[b].template||"";var d=[];var e=a[b].output;e.clean&&(this.cleanLocations[b]=BX.processHTML(e.clean,!1),delete e.clean);for(c in e)e.hasOwnProperty(c)&&d.push({output:BX.processHTML(e[c],!1),showAlt:a[b].showAlt,
lastValue:a[b].lastValue,coordinates:a[b].coordinates||!1});this.locations[b]=d}},locationsCompletion:function(){var a,b;this.locationsInitialized=!0;this.fixLocationsStyle(this.regionBlockNode,this.regionHiddenBlockNode);this.fixLocationsStyle(this.propsBlockNode,this.propsHiddenBlockNode);for(a in this.locations)if(this.locations.hasOwnProperty(a)&&(b=this.orderBlockNode.querySelector('[data-property-id-row="'+a+'"]'))){var c=b.querySelector("div.bx-ui-sls-clear");var d=b.querySelector("div.bx-ui-slst-pool");
var e=b.querySelector("input.bx-ui-sls-fake[type=text]");b.removeAttribute("style");this.bindValidation(a,b);c&&BX.bind(c,"click",function(f){f=BX.findParent(f.target||f.srcElement,{tagName:"DIV",className:"form-group"});var g;f&&(g=f.querySelector("input.bx-ui-sls-fake[type=text]"));g&&BX.fireEvent(g,"keyup")});!this.firstLoad&&this.options.propertyValidation&&(d&&(c=this.validation.properties[a],c=this.getValidationData(c,b),(b=BX.findParent(b,{className:"bx-soa-section"}))&&"true"==b.getAttribute("data-visited")&&
this.isValidProperty(c)),e&&BX.fireEvent(e,"keyup"))}this.firstLoad&&this.result.IS_AUTHORIZED&&"undefined"===typeof this.result.LAST_ORDER_DATA.FAIL?this.showActualBlock():this.result.SHOW_AUTH||this.changeVisibleContent();this.checkNotifications();this.activeSectionId!==this.regionBlockNode.id&&this.editFadeRegionContent(this.regionBlockNode.querySelector(".bx-soa-section-content"));this.activeSectionId!=this.propsBlockNode.id&&this.editFadePropsContent(this.propsBlockNode.querySelector(".bx-soa-section-content"))},
fixLocationsStyle:function(a,b){if(a&&b){b=this.activeSectionId==a.id?a:b;var c;a=b.querySelectorAll("div.bx-sls div.order__city-wrap.bx-ui-sls-input-block");b=b.querySelectorAll("div.bx-slst div.order__city-wrap.bx-ui-slst-input-block");if(a.length)for(c=0;c<a.length;c++)BX.addClass(a[c],"form-control");if(b.length)for(c=0;c<b.length;c++)BX.addClass(b[c],"form-control")}},clickOrderSaveAction:function(a){if(this.isValidForm())if(this.allowOrderSave(),"Y"===this.params.USER_CONSENT&&BX.UserConsent)BX.onCustomEvent("bx-soa-order-save",
[]);else this.doSaveAction();return BX.PreventDefault(a)},doSaveAction:function(){this.isOrderSaveAllowed()&&(this.reachGoal("order"),this.sendRequest("saveOrderAjax"))},clickNextAction:function(a){var b=BX.findParent(a.target||a.srcElement,{className:"bx-active"}),c=this.getNextSection(b);this.reachGoal("next",b);if((!this.result.IS_AUTHORIZED||"undefined"!==typeof this.result.LAST_ORDER_DATA.FAIL)&&"false"==c.next.getAttribute("data-visited")){var d=c.next.querySelector(".bx-soa-section-title-container");
BX.bind(d,"click",BX.proxy(this.showByClick,this));if(d=c.next.querySelector(".bx-soa-editstep"))d.style.display="";d=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active");c.next.id==d[d.length-1].id&&this.switchOrderSaveButtons(!0)}this.fade(b,c.next);this.show(c.next);return BX.PreventDefault(a)},clickPrevAction:function(a){var b=BX.findParent(a.target||a.srcElement,{className:"bx-active"}),c=this.getPrevSection(b);this.fade(b);this.show(c.next);this.animateScrollTo(c.next,800);return BX.PreventDefault(a)},
showAuthBlock:function(){var a=this.authBlockNode,b=BX(this.activeSectionId);a&&!BX.hasClass(a,"bx-selected")&&(b&&this.fade(b),this.show(a))},closeAuthBlock:function(){var a=this.authBlockNode,b=this.getNextSection(a).next;this.fade(a);BX.cleanNode(BX(b.id+"-hidden"));this.show(b)},shouldSkipSection:function(a){var b=!1;if("Y"===this.params.SKIP_USELESS_BLOCK){if(a.id===this.pickUpBlockNode.id){var c=this.getSelectedDelivery();c&&(b=1===this.getPickUpInfoArray(c.STORE).length)}a.id===this.deliveryBlockNode.id&&
(b=this.result.DELIVERY&&1===this.result.DELIVERY.length&&0===this.result.DELIVERY[0].EXTRA_SERVICES.length&&!this.result.DELIVERY[0].CALCULATE_ERRORS);a.id===this.paySystemBlockNode.id&&(b=this.result.PAY_SYSTEM&&1===this.result.PAY_SYSTEM.length&&"Y"!==this.result.PAY_FROM_ACCOUNT)}return b},getNextSection:function(a,b){if(!this.orderBlockNode||!a)return{};var c=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),d;for(d=0;d<c.length;d++)if(c[d].id===a.id&&c[d+1])return c=c[d+1],this.shouldSkipSection(c)?
(this.markSectionAsCompleted(c),this.getNextSection(c,c)):{prev:a,next:c,skip:b};return{next:a}},markSectionAsCompleted:function(a){if((!this.result.IS_AUTHORIZED||"undefined"!==typeof this.result.LAST_ORDER_DATA.FAIL)&&"false"===a.getAttribute("data-visited")){this.changeVisibleSection(a,!0);var b=a.querySelector(".bx-soa-section-title-container");BX.bind(b,"click",BX.proxy(this.showByClick,this))}a.setAttribute("data-visited","true");BX.addClass(a,"bx-step-completed");BX.remove(a.querySelector(".alert.alert-warning.alert-hide"));
this.checkBlockErrors(a)},getPrevSection:function(a){if(!this.orderBlockNode||!a)return{};var b=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),c;for(c=0;c<b.length;c++)if(b[c].id===a.id&&b[c-1])return b=b[c-1],this.shouldSkipSection(b)?(this.markSectionAsCompleted(b),this.getPrevSection(b)):{prev:a,next:b};return{next:a}},addAnimationEffect:function(a,b,c){a&&b&&(this.timeOut[a.id]&&(clearTimeout(this.timeOut[a.id].timer),BX.removeClass(a,this.timeOut[a.id].className)),setTimeout(function(){BX.addClass(a,
b)},10),this.timeOut[a.id]={className:b,timer:setTimeout(BX.delegate(function(){BX.removeClass(a,b);delete this.timeOut[a.id]},this),c||5E3)})},fade:function(a,b){if(a&&a.id&&this.activeSectionId==a.id){this.hasErrorSection[a.id]=!1;var c=a.offsetHeight;switch(a.id){case this.authBlockNode.id:this.authBlockNode.style.display="none";BX.removeClass(this.authBlockNode,"bx-active");break;case this.basketBlockNode.id:this.editFadeBasketBlock();break;case this.regionBlockNode.id:this.editFadeRegionBlock();
break;case this.paySystemBlockNode.id:BX.remove(this.paySystemBlockNode.querySelector(".alert.alert-warning.alert-hide"));this.editFadePaySystemBlock();break;case this.deliveryBlockNode.id:BX.remove(this.deliveryBlockNode.querySelector(".alert.alert-warning.alert-hide"));this.editFadeDeliveryBlock();break;case this.propsBlockNode.id:this.editFadePropsBlock()}BX.addClass(a,"bx-step-completed");BX.removeClass(a,"bx-selected");var d=a.offsetHeight;a.style.height=c+"px";if(b){var e=BX.GetWindowScrollPos().scrollTop,
f=BX.pos(this.orderBlockNode),g=BX.pos(a);var h=BX(b.id+"-hidden");h.style.left="-10000";h.style.position="absolute";this.orderBlockNode.appendChild(h);var k=b.offsetHeight;var l=h.offsetHeight+57;BX(a.id+"-hidden").parentNode.appendChild(h);h.removeAttribute("style");k=d+l-c-k;l=window.innerHeight-f.height-k;0<l?g=f.top-l/2:(g=g.top>e?g.top:g.bottom+6-c+d,g+window.innerHeight>f.bottom+25+k&&(g=f.bottom+25+k-window.innerHeight));g-=this.isMobile?50:0}(new BX.easing({duration:b?800:600,start:{height:c,
scrollTop:e},finish:{height:d,scrollTop:g},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(n){a.style.height=n.height+"px";b&&window.scrollTo(0,n.scrollTop)},complete:function(){a.style.height=""}})).animate();this.checkBlockErrors(a)}},show:function(a){if(a&&a.id&&this.activeSectionId!=a.id){this.activeSectionId=a.id;BX.removeClass(a,"bx-step-error bx-step-warning");switch(a.id){case this.authBlockNode.id:this.authBlockNode.style.display="";BX.addClass(this.authBlockNode,
"bx-active");break;case this.basketBlockNode.id:this.editActiveBasketBlock(!0);this.alignBasketColumns();break;case this.regionBlockNode.id:this.editActiveRegionBlock(!0);break;case this.deliveryBlockNode.id:this.editActiveDeliveryBlock(!0);break;case this.paySystemBlockNode.id:this.editActivePaySystemBlock(!0);break;case this.pickUpBlockNode.id:this.editActivePickUpBlock(!0);break;case this.propsBlockNode.id:this.editActivePropsBlock(!0)}"false"===a.getAttribute("data-visited")&&(this.showBlockErrors(a),
this.notifyAboutWarnings(a));a.setAttribute("data-visited","true");BX.addClass(a,"bx-selected");BX.removeClass(a,"bx-step-completed")}},showByClick:function(a){var b=BX.findParent(a.target||a.srcElement,{className:"bx-active"}),c=BX(this.activeSectionId),d=BX.GetWindowScrollPos().scrollTop;if(!b||BX.hasClass(b,"bx-selected"))return BX.PreventDefault(a);this.reachGoal("edit",b);c&&this.fade(c);this.show(b);setTimeout(BX.delegate(function(){BX.pos(b).top<d&&this.animateScrollTo(b,300)},this),320);return BX.PreventDefault(a)},
showActualBlock:function(){for(var a=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),b=0;a[b];){a[b].id===this.regionBlockNode.id&&this.isValidRegionBlock();a[b].id===this.propsBlockNode.id&&this.isValidPropertiesBlock();if(!this.checkBlockErrors(a[b])||!this.checkPreload(a[b])){this.activeSectionId!==a[b].id&&(BX(this.activeSectionId)&&this.fade(BX(this.activeSectionId)),this.show(a[b]));break}BX.addClass(a[b],"bx-step-completed");a[b].setAttribute("data-visited","true");b++}},
getBlockFooter:function(a){var b=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),c=b[0];b=b[b.length-1];var d=BX.findParent(a,{className:"bx-soa-section"}),e=!1,f=[];d&&"-1"==d.id.indexOf(c.id)&&f.push(BX.create("A",{props:{href:"javascript:void(0)",className:"pull-left btn btn--grey btn--m"},html:this.params.MESS_BACK,events:{click:BX.proxy(this.clickPrevAction,this)}}));d&&"-1"!=d.id.indexOf(b.id)&&(e=!0);e||f.push(BX.create("A",{props:{href:"javascript:void(0)",className:"pull-right btn btn--red btn--m"},
html:this.params.MESS_FURTHER,events:{click:BX.proxy(this.clickNextAction,this)}}));a.appendChild(BX.create("DIV",{props:{className:"row bx-soa-more"},children:[BX.create("DIV",{props:{className:"bx-soa-more-btn col-xs-12"},children:f})]}))},getNewContainer:function(a){return BX.create("DIV",{props:{className:"bx-soa-section-content"+(a?"":" container-fluid")}})},switchOrderSaveButtons:function(a){var b=this.orderSaveBlockNode,c=this.totalBlockNode.querySelector(".bx-soa-cart-total-button-container"),
d=this.mobileTotalBlockNode.querySelector(".bx-soa-cart-total-button-container");""==this.orderSaveBlockNode.style.display!=a&&(a?(b.style.opacity=0,b.style.display="",c&&(c.style.opacity=0,c.style.display=""),d&&(d.style.opacity=0,d.style.display=""),(new BX.easing({duration:500,start:{opacity:0},finish:{opacity:100},transition:BX.easing.transitions.linear,step:function(e){b.style.opacity=e.opacity/100;c&&(c.style.opacity=e.opacity/100);d&&(d.style.opacity=e.opacity/100)},complete:function(){b.removeAttribute("style");
c&&c.removeAttribute("style");d&&d.removeAttribute("style")}})).animate()):(b.style.display="none",c&&c.setAttribute("style","display: none !important"),d&&d.setAttribute("style","display: none !important")))},shouldBeSectionVisible:function(a,b){var c=!1,d;if(!a||!a.length)return c;for(;b<a.length;b++){if("true"==a[b].getAttribute("data-visited")){c=!0;break}if(!this.firstLoad&&(d=a[b].querySelector(".bx-soa-editstep"))&&"none"!==d.style.display){c=!0;break}}return c},changeVisibleContent:function(){var a=
this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),b,c=!!this.result.IS_AUTHORIZED&&"Y"===this.params.USE_PRELOAD&&!0!==this.result.LAST_ORDER_DATA.FAIL,d=!0;for(b=0;b<a.length;b++){var e=(e=this.firstLoad&&c)||this.shouldBeSectionVisible(a,b);this.changeVisibleSection(a[b],e);this.firstLoad&&d&&(e&&a[b+1]&&this.checkBlockErrors(a[b])&&(c&&this.checkPreload(a[b])||!c&&this.shouldSkipSection(a[b]))?(this.fade(a[b]),this.markSectionAsCompleted(a[b]),this.show(a[b+1])):d=!1)}this.result.IS_AUTHORIZED&&
"undefined"===typeof this.result.LAST_ORDER_DATA.FAIL||"final_step"!==this.params.SHOW_ORDER_BUTTON||this.switchOrderSaveButtons(this.shouldBeSectionVisible(a,a.length-1))},changeVisibleSection:function(a,b){var c;a.id!==this.basketBlockNode.id&&(c=a.querySelector(".bx-soa-section-content"))&&(c.style.display=b?"":"none");if(c=a.querySelector(".bx-soa-editstep"))c.style.display=b?"":"none";(a=a.querySelector(".bx-soa-section-title-container"))&&!b&&BX.unbindAll(a)},clearHiddenBlocks:function(){BX.remove(BX.lastChild(this.authHiddenBlockNode));
BX.remove(BX.lastChild(this.basketHiddenBlockNode));BX.remove(BX.lastChild(this.regionHiddenBlockNode));BX.remove(BX.lastChild(this.paySystemHiddenBlockNode));BX.remove(BX.lastChild(this.deliveryHiddenBlockNode));BX.remove(BX.lastChild(this.pickUpHiddenBlockNode));BX.remove(BX.lastChild(this.propsHiddenBlockNode))},editOrder:function(){if(this.orderBlockNode&&this.result){0<this.result.DELIVERY.length?(BX.addClass(this.deliveryBlockNode,"bx-active"),this.deliveryBlockNode.removeAttribute("style")):
(BX.removeClass(this.deliveryBlockNode,"bx-active"),this.deliveryBlockNode.style.display="none");this.orderSaveBlockNode.style.display=this.result.SHOW_AUTH?"none":"";this.mobileTotalBlockNode.style.display=this.result.SHOW_AUTH?"none":"";this.checkPickUpShow();var a=this.orderBlockNode.querySelectorAll(".bx-soa-section.bx-active"),b;for(b in a)a.hasOwnProperty(b)&&this.editSection(a[b]);this.editTotalBlock();this.totalBlockFixFont();this.showErrors(this.result.ERROR,!1);this.showWarnings()}},editSection:function(a){if(a&&
a.id){this.result.SHOW_AUTH&&a.id!=this.authBlockNode.id&&a.id!=this.basketBlockNode.id?a.style.display="none":a.id!=this.pickUpBlockNode.id&&(a.style.display="");var b=a.id==this.activeSectionId,c=a.querySelector(".bx-soa-section-title-container");BX.unbindAll(c);this.result.SHOW_AUTH?BX.bind(c,"click",BX.delegate(function(){this.animateScrollTo(this.authBlockNode);this.addAnimationEffect(this.authBlockNode,"bx-step-good")},this)):(BX.bind(c,"click",BX.proxy(this.showByClick,this)),(c=c.querySelector(".bx-soa-editstep"))&&
BX.bind(c,"click",BX.proxy(this.showByClick,this)));c=a.querySelector(".alert.alert-danger");this.hasErrorSection[a.id]=c&&"none"!=c.style.display;switch(a.id){case this.authBlockNode.id:this.editAuthBlock();break;case this.basketBlockNode.id:this.editBasketBlock(b);break;case this.regionBlockNode.id:this.editRegionBlock(b);break;case this.paySystemBlockNode.id:this.editPaySystemBlock(b);break;case this.deliveryBlockNode.id:this.editDeliveryBlock(b);break;case this.pickUpBlockNode.id:this.editPickUpBlock(b);
break;case this.propsBlockNode.id:this.editPropsBlock(b)}b&&a.setAttribute("data-visited","true")}},editAuthBlock:function(){if(this.authBlockNode){var a=this.authBlockNode.querySelector(".bx-soa-section-content");if(BX.hasClass(a,"reg")){var b=a;a=BX.firstChild(this.authHiddenBlockNode)}else b=BX.firstChild(this.authHiddenBlockNode);BX.cleanNode(a);BX.cleanNode(b);this.result.SHOW_AUTH?(this.getErrorContainer(a),this.editAuthorizeForm(a),this.editSocialContent(a),this.getAuthReference(a),this.getErrorContainer(b),
this.editRegistrationForm(b),this.getAuthReference(b)):(BX.onCustomEvent("OnBasketChange"),this.closeAuthBlock());this.result.OK_MESSAGE&&this.result.OK_MESSAGE.length&&(this.toggleAuthForm({target:this.authBlockNode.querySelector("input[type=submit]")}),a=BX.create("DIV",{props:{className:"alert alert-success"},text:this.result.OK_MESSAGE.join()}),this.result.OK_MESSAGE="",BX.prepend(a,this.authBlockNode.querySelector(".bx-soa-section-content")))}},editAuthorizeForm:function(a){var b=this.createAuthFormInputContainer(BX.message("STOF_LOGIN"),
BX.create("INPUT",{attrs:{"data-next":"USER_PASSWORD"},props:{name:"USER_LOGIN",type:"text",value:this.result.AUTH.USER_LOGIN,maxlength:"30"},events:{keypress:BX.proxy(this.checkKeyPress,this)}}));var c=this.createAuthFormInputContainer(BX.message("STOF_PASSWORD"),BX.create("INPUT",{attrs:{"data-send":!0},props:{name:"USER_PASSWORD",type:"password",value:"",maxlength:"30"},events:{keypress:BX.proxy(this.checkKeyPress,this)}}));var d=BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},
children:[BX.create("DIV",{props:{className:"checkbox"},children:[BX.create("LABEL",{props:{className:"bx-filter-param-label"},children:[BX.create("INPUT",{props:{type:"checkbox",name:"USER_REMEMBER",value:"Y"}}),BX.create("SPAN",{props:{className:"bx-filter-param-text"},text:BX.message("STOF_REMEMBER")})]})]})]});var e=BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("INPUT",{props:{id:"do_authorize",type:"hidden",name:"do_authorize",value:"N"}}),BX.create("INPUT",
{props:{type:"submit",className:"btn btn-lg btn-default",value:BX.message("STOF_ENTER")},events:{click:BX.delegate(function(f){BX("do_authorize").value="Y";this.sendRequest("showAuthForm");return BX.PreventDefault(f)},this)}})]});b=BX.create("DIV",{props:{className:"bx-authform"},children:[BX.create("H3",{props:{className:"bx-title"},text:BX.message("STOF_AUTH_REQUEST")}),b,c,d,e,BX.create("A",{props:{href:this.params.PATH_TO_AUTH+"?forgot_password=yes&back_url="+encodeURIComponent(document.location.href)},
text:BX.message("STOF_FORGET_PASSWORD")})]});a.appendChild(BX.create("DIV",{props:{className:"col-md-6"},children:[b]}))},createAuthFormInputContainer:function(a,b,c){var d="";c&&(d+='<span class="bx-authform-starrequired">*</span>');return BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("DIV",{props:{className:"bx-authform-label-container"},html:d+a}),BX.create("DIV",{props:{className:"bx-authform-input-container"},children:[b]})]})},activatePhoneAuth:function(){this.result.SMS_AUTH&&
new BX.PhoneAuth({containerId:"bx_register_resend",errorContainerId:"bx_register_error",interval:60,data:{signedData:this.result.SMS_AUTH.SIGNED_DATA},onError:function(a){var b=BX("bx_register_error"),c=BX.findChildByClassName(b,"errortext");c.innerHTML="";for(var d=0;d<a.errors.length;d++)c.innerHTML=c.innerHTML+BX.util.htmlspecialchars(a.errors[d].message)+"<br>";b.style.display=""}})},editRegistrationForm:function(a){if(this.result.AUTH){var b=[],c=this.result.SMS_AUTH&&"OK"===this.result.SMS_AUTH.TYPE;
c?(b.push(BX.create("DIV",{props:{className:"alert alert-success"},text:BX.message("STOF_REG_SMS_REQUEST")})),b.push(BX.create("INPUT",{props:{type:"hidden",name:"SIGNED_DATA",value:this.result.SMS_AUTH.SIGNED_DATA||""}})),b.push(this.createAuthFormInputContainer(BX.message("STOF_SMS_CODE"),BX.create("INPUT",{attrs:{"data-send":!0},props:{name:"SMS_CODE",type:"text",size:40,value:""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0)),b.push(BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},
children:[BX.create("INPUT",{props:{name:"code_submit_button",type:"submit",className:"btn btn-lg btn-default",value:BX.message("STOF_SEND")},events:{click:BX.delegate(function(d){this.sendRequest("confirmSmsCode");return BX.PreventDefault(d)},this)}})]})),b.push(BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("DIV",{props:{id:"bx_register_error"},style:{display:"none"}}),BX.create("DIV",{props:{id:"bx_register_resend"}})]}))):(b.push(BX.create("H3",{props:{className:"bx-title"},
text:BX.message("STOF_REG_REQUEST")})),b.push(this.createAuthFormInputContainer(BX.message("STOF_NAME"),BX.create("INPUT",{attrs:{"data-next":"NEW_LAST_NAME"},props:{name:"NEW_NAME",type:"text",size:40,value:this.result.AUTH.NEW_NAME||""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0)),b.push(this.createAuthFormInputContainer(BX.message("STOF_LASTNAME"),BX.create("INPUT",{attrs:{"data-next":"NEW_EMAIL"},props:{name:"NEW_LAST_NAME",type:"text",size:40,value:this.result.AUTH.NEW_LAST_NAME||
""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0)),b.push(this.createAuthFormInputContainer(BX.message("STOF_EMAIL"),BX.create("INPUT",{attrs:{"data-next":"PHONE_NUMBER"},props:{name:"NEW_EMAIL",type:"text",size:40,value:this.result.AUTH.NEW_EMAIL||""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),"Y"==this.result.AUTH.new_user_email_required)),"Y"===this.result.AUTH.new_user_phone_auth&&b.push(this.createAuthFormInputContainer(BX.message("STOF_PHONE"),BX.create("INPUT",{attrs:{"data-next":"captcha_word"},
props:{name:"PHONE_NUMBER",type:"text",size:40,value:this.result.AUTH.PHONE_NUMBER||""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),"Y"===this.result.AUTH.new_user_phone_required)),this.authGenerateUser&&(b.push(BX.create("LABEL",{props:{for:"NEW_GENERATE_N"},children:[BX.create("INPUT",{attrs:{checked:!this.authGenerateUser},props:{id:"NEW_GENERATE_N",type:"radio",name:"NEW_GENERATE",value:"N"}}),BX.message("STOF_MY_PASSWORD")],events:{change:BX.delegate(function(){this.authBlockNode.querySelector(".generated").style.display=
"";this.authGenerateUser=!1},this)}})),b.push(BX.create("BR")),b.push(BX.create("LABEL",{props:{for:"NEW_GENERATE_Y"},children:[BX.create("INPUT",{attrs:{checked:this.authGenerateUser},props:{id:"NEW_GENERATE_Y",type:"radio",name:"NEW_GENERATE",value:"Y"}}),BX.message("STOF_SYS_PASSWORD")],events:{change:BX.delegate(function(){this.authBlockNode.querySelector(".generated").style.display="none";this.authGenerateUser=!0},this)}}))),b.push(BX.create("DIV",{props:{className:"generated"},style:{display:this.authGenerateUser?
"none":""},children:[this.createAuthFormInputContainer(BX.message("STOF_LOGIN"),BX.create("INPUT",{props:{name:"NEW_LOGIN",type:"text",size:30,value:this.result.AUTH.NEW_LOGIN||""},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0),this.createAuthFormInputContainer(BX.message("STOF_PASSWORD"),BX.create("INPUT",{props:{name:"NEW_PASSWORD",type:"password",size:30},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0),this.createAuthFormInputContainer(BX.message("STOF_RE_PASSWORD"),BX.create("INPUT",
{props:{name:"NEW_PASSWORD_CONFIRM",type:"password",size:30},events:{keypress:BX.proxy(this.checkKeyPress,this)}}),!0)]})),"Y"==this.result.AUTH.captcha_registration&&b.push(BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},children:[BX.create("DIV",{props:{className:"bx-authform-label-container"},children:[BX.create("SPAN",{props:{className:"bx-authform-starrequired"},text:"*"}),BX.message("CAPTCHA_REGF_PROMT"),BX.create("DIV",{props:{className:"bx-captcha"},children:[BX.create("INPUT",
{props:{name:"captcha_sid",type:"hidden",value:this.result.AUTH.capCode||""}}),BX.create("IMG",{props:{src:"/bitrix/tools/captcha.php?captcha_sid="+this.result.AUTH.capCode,alt:""}})]})]}),BX.create("DIV",{props:{className:"bx-authform-input-container"},children:[BX.create("INPUT",{attrs:{"data-send":!0},props:{name:"captcha_word",type:"text",size:"30",maxlength:"50",value:""},events:{keypress:BX.proxy(this.checkKeyPress,this)}})]})]})),b.push(BX.create("DIV",{props:{className:"bx-authform-formgroup-container"},
children:[BX.create("INPUT",{props:{id:"do_register",name:"do_register",type:"hidden",value:"N"}}),BX.create("INPUT",{props:{type:"submit",className:"btn btn-lg btn-default",value:BX.message("STOF_REGISTER")},events:{click:BX.delegate(function(d){BX("do_register").value="Y";this.sendRequest("showAuthForm");return BX.PreventDefault(d)},this)}}),BX.create("A",{props:{className:"btn btn-link",href:""},text:BX.message("STOF_DO_AUTHORIZE"),events:{click:BX.delegate(function(d){this.toggleAuthForm(d);return BX.PreventDefault(d)},
this)}})]})));a.appendChild(BX.create("DIV",{props:{className:"col-md-12"},children:[BX.create("DIV",{props:{className:"bx-authform"},children:b})]}));c&&this.activatePhoneAuth()}},editSocialContent:function(a){if(BX("bx-soa-soc-auth-services")){var b=[];if(!1===this.socServiceHiddenNode){var c=BX("bx-soa-soc-auth-services").querySelector(".bx-authform-social");BX.type.isDomNode(c)&&(this.socServiceHiddenNode=c.innerHTML,BX.remove(c))}this.socServiceHiddenNode&&(b.push(BX.create("DIV",{props:{className:"bx-authform-social"},
html:'<h3 class="bx-title">'+BX.message("SOA_DO_SOC_SERV")+"</h3>"+this.socServiceHiddenNode})),b.push(BX.create("hr",{props:{className:"bxe-light"}})));"Y"===this.result.AUTH.new_user_registration&&b.push(BX.create("DIV",{props:{className:"bx-soa-reg-block"},children:[BX.create("P",{html:this.params.MESS_REGISTRATION_REFERENCE}),BX.create("A",{props:{className:"btn btn-default btn-lg"},text:BX.message("STOF_DO_REGISTER"),events:{click:BX.delegate(function(d){this.toggleAuthForm(d);return BX.PreventDefault(d)},
this)}})]}));a.appendChild(BX.create("DIV",{props:{className:"col-md-6"},children:b}))}},getAuthReference:function(a){a.appendChild(BX.create("DIV",{props:{className:"row"},children:[BX.create("DIV",{props:{className:"bx-soa-reference col-xs-12"},children:[this.params.MESS_AUTH_REFERENCE_1,BX.create("BR"),this.params.MESS_AUTH_REFERENCE_2,BX.create("BR"),this.params.MESS_AUTH_REFERENCE_3]})]}))},toggleAuthForm:function(a){if(a){a=a.target||a.srcElement;var b=BX.findParent(a,{className:"bx-soa-section"}),
c=BX.findParent(a,{className:"bx-soa-section-content"}),d=BX.firstChild(this.authHiddenBlockNode);(new BX.easing({duration:100,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){c.style.opacity=e.opacity/100}})).animate();this.authHiddenBlockNode.appendChild(c);BX.cleanNode(b);b.appendChild(BX.create("DIV",{props:{className:"bx-soa-section-title-container"},children:[BX.create("h2",{props:{className:"bx-soa-section-title col-xs-7 col-sm-9"},
html:BX.hasClass(d,"reg")?this.params.MESS_REG_BLOCK_NAME:this.params.MESS_AUTH_BLOCK_NAME})]}));d.style.opacity=0;b.appendChild(d);setTimeout(function(){(new BX.easing({duration:100,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function(e){d.style.opacity=e.opacity/100},complete:function(){d.style.height="";d.style.opacity=""}})).animate()},110);this.animateScrollTo(b)}},alignBasketColumns:function(){if(this.basketBlockNode){var a=0,b=BX.GetWindowInnerSize();
if(580<b.innerWidth&&992>b.innerWidth){b=this.basketBlockNode.querySelectorAll(".bx-soa-basket-info");var c=100;if(b.length){var d=b[0].querySelectorAll(".bx-soa-item-properties");if(!d.length||""==d[0].style.width){var e=d.length;if(0<e)for(c=parseInt(c/(4<e?4:e));a<b.length;a++)for(d=b[a].querySelectorAll(".bx-soa-item-properties"),e=0;e<d.length;e++)d[e].style.width=c+"%"}}}else if(d=this.basketBlockNode.querySelectorAll(".bx-soa-item-properties"),!d.length||""!=d[0].style.width)for(;a<d.length;a++)d[a].style.width=
""}},editBasketBlock:function(a){this.basketBlockNode&&this.basketHiddenBlockNode&&this.result.GRID&&(BX.remove(BX.lastChild(this.basketBlockNode)),BX.remove(BX.lastChild(this.basketHiddenBlockNode)),this.editActiveBasketBlock(a),this.editFadeBasketBlock(a),this.initialized.basket=!0)},editActiveBasketBlock:function(a){a=a?this.basketBlockNode:this.basketHiddenBlockNode;if(this.initialized.basket)this.basketHiddenBlockNode.appendChild(BX.lastChild(a)),a.appendChild(BX.firstChild(this.basketHiddenBlockNode));
else{var b=a.querySelector(".bx-soa-section-content");var c=BX.create("DIV",{props:{className:"bx-soa-item-table"}});b?BX.cleanNode(b):(b=this.getNewContainer(),a.appendChild(b));this.editBasketItems(c,!0);b.appendChild(BX.create("DIV",{props:{className:"bx-soa-table-fade"},children:[BX.create("DIV",{style:{overflowX:"auto",overflowY:"hidden"},children:[c]})]}));"Y"===this.params.SHOW_COUPONS_BASKET&&this.editCoupons(b);this.getBlockFooter(b);BX.bind(b.querySelector("div.bx-soa-table-fade").firstChild,
"scroll",BX.proxy(this.basketBlockScrollCheckEvent,this))}this.alignBasketColumns()},editFadeBasketBlock:function(a){a=a?this.basketHiddenBlockNode:this.basketBlockNode;if(this.initialized.basket)this.basketHiddenBlockNode.appendChild(a.querySelector(".bx-soa-section-content")),this.basketBlockNode.appendChild(BX.firstChild(this.basketHiddenBlockNode));else{var b=this.getNewContainer();var c=BX.create("DIV",{props:{className:"bx-soa-item-table"}});this.editBasketItems(c,!1);b.appendChild(BX.create("DIV",
{props:{className:"bx-soa-table-fade"},children:[BX.create("DIV",{style:{overflowX:"auto",overflowY:"hidden"},children:[c]})]}));"Y"===this.params.SHOW_COUPONS_BASKET&&this.editCouponsFade(b);a.appendChild(b);this.alignBasketColumns();this.basketBlockScrollCheck();BX.bind(this.basketBlockNode.querySelector("div.bx-soa-table-fade").firstChild,"scroll",BX.proxy(this.basketBlockScrollCheckEvent,this))}this.alignBasketColumns()},editBasketItems:function(a,b){if(this.result.GRID.ROWS){var c=0,d;"Y"===
this.params.SHOW_BASKET_HEADERS&&this.editBasketItemsHeader(a);for(d in this.result.GRID.ROWS)this.result.GRID.ROWS.hasOwnProperty(d)&&this.createBasketItem(a,this.result.GRID.ROWS[d],c++,!!b)}},editBasketItemsHeader:function(a){if(a){var b=[BX.create("DIV",{props:{className:"table__item"},text:BX.message("SOA_SUM_NAME")})],c=0,d;for(d=0;d<this.result.GRID.HEADERS.length;d++){var e=this.result.GRID.HEADERS[d];if("NAME"!==e.id&&"PREVIEW_PICTURE"!==e.id&&"PROPS"!==e.id&&"NOTES"!==e.id&&("DETAIL_PICTURE"!==
e.id||this.options.showPreviewPicInBasket)){var f=BX.util.in_array(e.id,["QUANTITY","PRICE_FORMATED","DISCOUNT_PRICE_PERCENT_FORMATED","SUM"]);b.push(BX.create("DIV",{props:{className:"table__item"+(f?" bx-text-right":"")},text:e.name}));++c;4==c&&this.result.GRID.HEADERS[d+1]&&(b.push(BX.create("DIV",{props:{className:"bx-soa-item-nth-4p1"}})),c=0)}}a.appendChild(BX.create("DIV",{props:{className:"table__row table__header"},children:b}))}},createBasketItem:function(a,b,c,d){var e=[],f=[],g=[],h=
0,k;(this.options.showPreviewPicInBasket||this.options.showDetailPicInBasket)&&e.push(this.createBasketItemImg(b.data));e.push(this.createBasketItemContent(b.data));for(k=0;k<this.result.GRID.HEADERS.length;k++){var l=this.result.GRID.HEADERS[k];"NAME"===l.id||"PREVIEW_PICTURE"===l.id||"PROPS"===l.id||"NOTES"===l.id||"DETAIL_PICTURE"===l.id&&!this.options.showPreviewPicInBasket||(f.push(this.createBasketItemColumn(l,b,d)),++h,4==h&&this.result.GRID.HEADERS[k+1]&&(f.push(BX.create("DIV",{props:{className:"bx-soa-item-nth-4p1"}})),
h=0))}if(d)for(k=0;k<this.result.GRID.HEADERS_HIDDEN.length;k++)d=this.createBasketItemHiddenColumn(this.result.GRID.HEADERS_HIDDEN[k],b),BX.type.isArray(d)?g=g.concat(d):d&&g.push(d);b=[BX.create("DIV",{props:{className:"table__item"},style:{minWidth:"180px"},children:e})].concat(f);a.appendChild(BX.create("DIV",{props:{className:"table__row"+(0==c?" bx-soa-item-tr-first":"")},children:b}))},showAdditionalProperties:function(a){var b=a.target||a.srcElement,c=b.nextSibling,d=BX.findParent(b,{className:"bx-soa-item-tr bx-soa-item-info-container"});
b=d.offsetHeight;if(BX.hasClass(c,"bx-active"))(new BX.easing({duration:300,start:{opacity:100,height:b},finish:{opacity:0,height:35},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(f){c.style.opacity=f.opacity/100;c.style.height=f.height+"px";d.style.height=f.height+"px"},complete:function(){BX.removeClass(c,"bx-active");c.removeAttribute("style");d.removeAttribute("style")}})).animate();else{c.style.opacity=0;BX.addClass(c,"bx-active");var e=c.offsetHeight+b;BX.removeClass(c,
"bx-active");c.style.paddingTop="10px";(new BX.easing({duration:300,start:{opacity:0,height:b},finish:{opacity:100,height:e},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(f){c.style.opacity=f.opacity/100;c.style.height=f.height+"px";d.style.height=f.height+"px"},complete:function(){BX.addClass(c,"bx-active");c.removeAttribute("style")}})).animate()}return BX.PreventDefault(a)},createBasketItemImg:function(a){if(a){var b;var c=BX.create("DIV",{props:{className:"bx-soa-item-imgcontainer"}});
a.PREVIEW_PICTURE_SRC&&a.PREVIEW_PICTURE_SRC.length?b=this.getImageSources(a,"PREVIEW_PICTURE"):a.DETAIL_PICTURE_SRC&&a.DETAIL_PICTURE_SRC.length&&(b=this.getImageSources(a,"DETAIL_PICTURE"));b&&b.src_2x?c.setAttribute("style",'background-image: url("'+b.src_1x+'");background-image: -webkit-image-set(url("'+b.src_1x+'") 1x, url("'+b.src_2x+'") 2x)'):(b=b&&b.src_1x||this.defaultBasketItemLogo,c.setAttribute("style",'background-image: url("'+b+'");'));"Y"!==this.params.HIDE_DETAIL_PAGE_URL&&a.DETAIL_PAGE_URL&&
a.DETAIL_PAGE_URL.length&&(c=BX.create("A",{props:{href:a.DETAIL_PAGE_URL},children:[c]}));return BX.create("DIV",{props:{className:"bx-soa-item-img-block"},children:[c]})}},createBasketItemContent:function(a){var b=this.htmlspecialcharsEx(a.NAME||""),c=a.PROPS||[],d=[];"Y"!==this.params.HIDE_DETAIL_PAGE_URL&&a.DETAIL_PAGE_URL&&a.DETAIL_PAGE_URL.length&&(b='<a href="'+a.DETAIL_PAGE_URL+'">'+b+"</a>");if(this.options.showPropsInBasket&&c.length)for(var e in c)c.hasOwnProperty(e)&&(a=c[e].VALUE||"",
d.push(BX.create("DIV",{props:{className:"bx-soa-item-td-title"},style:{textAlign:"left"},text:c[e].NAME||""})),d.push(BX.create("DIV",{props:{className:"bx-soa-item-td-text"},style:{textAlign:"left"},text:a})));return BX.create("DIV",{props:{className:"bx-soa-item-content"},children:d.length?[BX.create("DIV",{props:{className:"bx-soa-item-title"},html:b}),BX.create("DIV",{props:{className:"bx-scu-container"},children:d})]:[BX.create("DIV",{props:{className:"bx-soa-item-title"},html:b})]})},createBasketItemColumn:function(a,
b,c){if(a&&b){var d=b.columns[a.id]?b.columns:b.data,e=BX.util.in_array(a.id,["QUANTITY","PRICE_FORMATED","DISCOUNT_PRICE_PERCENT_FORMATED","SUM"]),f=BX.create("DIV",{props:{className:"bx-soa-item-td-text"}}),g="";if("PRICE_FORMATED"===a.id)f.appendChild(BX.create("STRONG",{props:{className:"bx-price"},html:d.PRICE_FORMATED})),g=d.PRICE_FORMATED,0<parseFloat(d.DISCOUNT_PRICE)&&(f.appendChild(BX.create("BR")),f.appendChild(BX.create("STRONG",{props:{className:"bx-price-old"},html:d.BASE_PRICE_FORMATED})),
g+=` ${d.BASE_PRICE_FORMATED}`),this.options.showPriceNotesInBasket&&c&&(f.appendChild(BX.create("BR")),f.appendChild(BX.create("SMALL",{text:d.NOTES})));else if("SUM"===a.id)f.appendChild(BX.create("STRONG",{props:{className:"bx-price all"},html:d.SUM})),0<parseFloat(d.DISCOUNT_PRICE)&&(f.appendChild(BX.create("BR")),f.appendChild(BX.create("STRONG",{props:{className:"bx-price-old"},html:d.SUM_BASE_FORMATED})),g=d.SUM_BASE_FORMATED),g=d.SUM;else if("DISCOUNT"===a.id)f.appendChild(BX.create("STRONG",
{props:{className:"bx-price"},text:d.DISCOUNT_PRICE_PERCENT_FORMATED}));else if("DETAIL_PICTURE"===a.id){var h=this.getImageSources(b.data,a.id);var k=BX.create("IMG",{props:{src:h&&h.src_1x||this.defaultBasketItemLogo}});h&&h.src_1x&&h.src_orig&&BX.bind(k,"click",BX.delegate(function(l){this.popupShow(l,h.src_orig)},this));f.appendChild(k)}else if(BX.util.in_array(a.id,["QUANTITY","WEIGHT_FORMATED","DISCOUNT_PRICE_PERCENT_FORMATED"]))f.appendChild(BX.create("SPAN",{html:d[a.id]})),g=d[a.id];else if("PREVIEW_TEXT"===
a.id)"html"===d.PREVIEW_TEXT_TYPE?f.appendChild(BX.create("SPAN",{html:d.PREVIEW_TEXT||""})):f.appendChild(BX.create("SPAN",{text:d.PREVIEW_TEXT||""}));else if(b=d[a.id],c=[],BX.type.isArray(b)){for(k in b)b.hasOwnProperty(k)&&("image"==b[k].type?c.push(this.getImageContainer(b[k].value,b[k].source)):"linked"==b[k].type?(f.appendChild(BX.create("SPAN",{html:b[k].value_format})),f.appendChild(BX.create("BR"))):b[k].value&&(f.appendChild(BX.create("SPAN",{html:b[k].value})),f.appendChild(BX.create("BR"))));
c.length&&f.appendChild(BX.create("DIV",{props:{className:"bx-scu-list"},children:[BX.create("UL",{props:{className:"bx-scu-itemlist"},children:c})]}))}else b&&f.appendChild(BX.create("SPAN",{html:BX.util.htmlspecialchars(b)}));return BX.create("DIV",{props:{className:"table__item"+(e?" bx-text-right":"")},children:[BX.create("SPAN",{text:a.name}),BX.create("div",{html:g})]})}},createBasketItemHiddenColumn:function(a,b){if(a&&b){var c=b.columns[a.id]?b.columns:b.data,d=BX.create("TD",{props:{className:"bx-soa-info-text"}});
if("PROPS"===a.id){if(a=[],(d=b.data.PROPS)&&d.length){for(f in d)d.hasOwnProperty(f)&&(b=d[f].VALUE||"",0!=b.length&&a.push(BX.create("TR",{props:{className:"bx-soa-info-line"},children:[BX.create("TD",{props:{className:"bx-soa-info-title"},text:(d[f].NAME||"")+":"}),BX.create("TD",{props:{className:"bx-soa-info-text"},html:BX.util.htmlspecialchars(b)})]})));return a}}else{if("PRICE_FORMATED"===a.id)d.appendChild(BX.create("STRONG",{props:{className:"bx-price"},html:c.PRICE_FORMATED})),0<parseFloat(c.DISCOUNT_PRICE)&&
(d.appendChild(BX.create("BR")),d.appendChild(BX.create("STRONG",{props:{className:"bx-price-old"},html:c.BASE_PRICE_FORMATED})));else if("SUM"===a.id)d.appendChild(BX.create("STRONG",{props:{className:"bx-price all"},text:c.SUM}));else if("DISCOUNT"===a.id)d.appendChild(BX.create("STRONG",{props:{className:"bx-price"},text:c.DISCOUNT_PRICE_PERCENT_FORMATED}));else if("DETAIL_PICTURE"===a.id||"PREVIEW_PICTURE"===a.id){var e=this.getImageSources(b.data,a.id);var f=BX.create("IMG",{props:{src:e&&e.src_1x||
this.defaultBasketItemLogo},style:{maxWidth:"50%"}});e&&e.src_1x&&e.src_orig&&BX.bind(f,"click",BX.delegate(function(g){this.popupShow(g,e.src_orig)},this));d.appendChild(f)}else if(BX.util.in_array(a.id,["QUANTITY","WEIGHT_FORMATED","DISCOUNT_PRICE_PERCENT_FORMATED"]))d.appendChild(BX.create("SPAN",{html:c[a.id]}));else if("PREVIEW_TEXT"===a.id)"html"===c.PREVIEW_TEXT_TYPE?d.appendChild(BX.create("SPAN",{html:c.PREVIEW_TEXT||""})):d.appendChild(BX.create("SPAN",{text:c.PREVIEW_TEXT||""}));else if(b=
c[a.id],c=[],BX.type.isArray(b)){for(f in b)if(b.hasOwnProperty(f))if("image"==b[f].type)c.push(this.getImageContainer(b[f].value,b[f].source));else if("linked"==b[f].type)d.appendChild(BX.create("SPAN",{html:b[f].value_format})),d.appendChild(BX.create("BR"));else if(b[f].value)d.appendChild(BX.create("SPAN",{html:b[f].value})),d.appendChild(BX.create("BR"));else return;c.length&&d.appendChild(BX.create("DIV",{props:{className:"bx-scu-list"},children:[BX.create("UL",{props:{className:"bx-scu-itemlist"},
children:c})]}))}else if(b)d.appendChild(BX.create("SPAN",{html:BX.util.htmlspecialchars(b)}));else return;return BX.create("TR",{props:{className:"bx-soa-info-line"},children:[BX.create("TD",{props:{className:"bx-soa-info-title"},text:a.name+":"}),d]})}}},popupShow:function(a,b,c){this.popup&&this.popup.destroy();var d=this;this.popup=new BX.PopupWindow("bx-soa-image-popup",null,{lightShadow:!0,offsetTop:0,offsetLeft:0,closeIcon:{top:"3px",right:"10px"},autoHide:!0,bindOptions:{position:"bottom"},
closeByEsc:!0,zIndex:100,events:{onPopupShow:function(){BX.create("IMG",{props:{src:c||b},events:{load:function(){var e=BX("bx-soa-image-popup-content");if(e){var f=BX.GetWindowInnerSize(),g=this.isMobile?.5:.9;BX.cleanNode(e);e.appendChild(this);var h=e.offsetHeight;var k=e.offsetWidth;h>f.innerHeight*g&&(e.style.height=f.innerHeight*g+"px",e.style.width=f.innerHeight*g/h*k+"px",h=e.offsetHeight,k=e.offsetWidth);k>f.innerWidth*g&&(e.style.width=f.innerWidth*g+"px",e.style.height=f.innerWidth*g/k*
h+"px");e.style.height=e.offsetHeight+"px";e.style.width=e.offsetWidth+"px";d.popup.adjustPosition()}}}})},onPopupClose:function(){this.destroy()}},content:BX.create("DIV",{props:{id:"bx-soa-image-popup-content"},children:[BX.create("IMG",{props:{src:this.templateFolder+"/images/loader.gif"}})]})});this.popup.show()},getImageContainer:function(a,b){return BX.create("LI",{props:{className:"bx-img-item"},children:[BX.create("DIV",{props:{className:"bx-scu-itemColorBlock"},children:[BX.create("DIV",
{props:{className:"bx-img-itemColor"},style:{backgroundImage:'url("'+a+'")'}})],events:{click:BX.delegate(function(c){this.popupShow(c,a,b)},this)}})]})},editCoupons:function(a){var b=this.getCouponsList(!0),c=this.getCouponsLabel(!0);b=BX.create("DIV",{props:{className:"bx-soa-coupon-block"},children:[BX.create("DIV",{props:{className:"bx-soa-coupon-input"},children:[BX.create("INPUT",{props:{className:"form-control bx-ios-fix",type:"text"},events:{change:BX.delegate(function(d){(d=BX.getEventTarget(d))&&
d.value&&(this.sendRequest("enterCoupon",d.value),d.value="")},this)}})]}),BX.create("SPAN",{props:{className:"bx-soa-coupon-item"},children:b})]});a.appendChild(BX.create("DIV",{props:{className:"bx-soa-coupon"},children:[c,b]}))},editCouponsFade:function(a){if(!(1>this.result.COUPON_LIST.length)){var b=this.getCouponsList(!1);if(b.length){var c=this.getCouponsLabel(!1);b=BX.create("DIV",{props:{className:"bx-soa-coupon-block"},children:[BX.create("DIV",{props:{className:"bx-soa-coupon-list"},children:[BX.create("DIV",
{props:{className:"bx-soa-coupon-item"},children:[c].concat(b)})]})]});a.appendChild(BX.create("DIV",{props:{className:"bx-soa-coupon bx-soa-coupon-item-fixed"},children:[b]}))}}},getCouponsList:function(a){var b=[],c;for(c=0;c<this.result.COUPON_LIST.length;c++)(a||!a&&"APPLIED"==this.result.COUPON_LIST[c].JS_STATUS)&&b.push(this.getCouponNode({text:this.result.COUPON_LIST[c].COUPON,desc:this.result.COUPON_LIST[c].JS_CHECK_CODE,status:this.result.COUPON_LIST[c].JS_STATUS},a));return b},getCouponNode:function(a,
b){var c=BX.util.htmlspecialchars(a.text)||"",d=a.desc&&a.desc.length?a.desc.charAt(0).toUpperCase()+a.desc.slice(1):BX.message("SOA_NOT_FOUND");switch((a.status||"BAD").toUpperCase()){case "ENTERED":a="used";var e="warning";break;case "BAD":a=e="danger";break;default:a=e="success"}return BX.create("STRONG",{attrs:{"data-coupon":c,className:"bx-soa-coupon-item-"+a},children:b?[c||"",BX.create("SPAN",{props:{className:"bx-soa-coupon-remove"},events:{click:BX.delegate(function(f){(f=BX.findParent(f.target||
f.srcElement,{tagName:"STRONG"}))&&f.getAttribute("data-coupon")&&this.sendRequest("removeCoupon",f.getAttribute("data-coupon"))},this)}}),BX.create("SPAN",{props:{className:"bx-soa-tooltip bx-soa-tooltip-coupon bx-soa-tooltip-"+e+" tooltip top"},children:[BX.create("SPAN",{props:{className:"tooltip-arrow"}}),BX.create("SPAN",{props:{className:"tooltip-inner"},text:d})]})]:[c]})},getCouponsLabel:function(a){return BX.create("DIV",{props:{className:"bx-soa-coupon-label"},children:a?[BX.create("LABEL",
{html:this.params.MESS_USE_COUPON+":"})]:[this.params.MESS_COUPON+":"]})},addCoupon:function(a){for(var b=this.orderBlockNode.querySelectorAll(".bx-soa-coupon:not(.bx-soa-coupon-item-fixed) .bx-soa-coupon-item"),c=0;c<b.length&&!b[c].querySelector('[data-coupon="'+BX.util.htmlspecialchars(a)+'"]');c++)b[c].appendChild(this.getCouponNode({text:a},!0,"bx-soa-coupon-item-danger"))},removeCoupon:function(a){a=this.orderBlockNode.querySelectorAll('[data-coupon="'+BX.util.htmlspecialchars(a)+'"]');for(var b in a)a.hasOwnProperty(b)&&
BX.remove(a[b])},editRegionBlock:function(a){this.regionBlockNode&&this.regionHiddenBlockNode&&this.result.PERSON_TYPE&&(a?(this.editActiveRegionBlock(!0),!this.regionBlockNotEmpty&&this.editFadeRegionBlock()):this.editFadeRegionBlock(),this.initialized.region=!0)},editActiveRegionBlock:function(a){var b=a?this.regionBlockNode:this.regionHiddenBlockNode;if(this.initialized.region)BX.remove(BX.lastChild(b)),b.appendChild(BX.firstChild(this.regionHiddenBlockNode));else{(a=b.querySelector(".bx-soa-section-content"))?
BX.cleanNode(a):(a=this.getNewContainer(),b.appendChild(a));this.getErrorContainer(a);b=BX.create("DIV",{props:{className:"bx_soa_location row"}});var c=BX.create("DIV",{props:{className:"profile__list"}});this.getPersonTypeControl(c);this.getProfilesControl(c);this.getDeliveryLocationInput(c);this.result.SHOW_AUTH||(this.regionBlockNotEmpty?(BX.addClass(this.regionBlockNode,"bx-active"),this.regionBlockNode.style.display=""):(BX.removeClass(this.regionBlockNode,"bx-active"),this.regionBlockNode.style.display=
"none",this.result.IS_AUTHORIZED&&"undefined"===typeof this.result.LAST_ORDER_DATA.FAIL||this.initFirstSection()));b.appendChild(c);a.appendChild(b);this.getBlockFooter(a)}},editFadeRegionBlock:function(){var a=this.regionBlockNode.querySelector(".bx-soa-section-content");this.initialized.region?this.regionHiddenBlockNode.appendChild(a):(this.editActiveRegionBlock(!1),BX.remove(BX.lastChild(this.regionBlockNode)));a=this.getNewContainer(!0);this.regionBlockNode.appendChild(a);this.editFadeRegionContent(a)},
editFadeRegionContent:function(a){if(a&&this.locationsInitialized){var b=this.getSelectedPersonType(),c=this.regionHiddenBlockNode.querySelector(".alert.alert-danger"),d="",e=[];var f="";BX.cleanNode(a);c&&a.appendChild(c.cloneNode(!0));b&&b.NAME&&1<this.result.PERSON_TYPE.length&&(d+="<strong>"+this.params.MESS_PERSON_TYPE+":</strong> "+BX.util.htmlspecialchars(b.NAME)+"<br>");b&&(e="PROPS_FADE_LIST_"+b.ID,e=this.params[e]||[]);for(k in this.result.ORDER_PROP.properties)if(this.result.ORDER_PROP.properties.hasOwnProperty(k))if("Y"==
this.result.ORDER_PROP.properties[k].IS_LOCATION&&this.result.ORDER_PROP.properties[k].ID==this.deliveryLocationInfo.loc)var g=this.result.ORDER_PROP.properties[k];else if("Y"==this.result.ORDER_PROP.properties[k].IS_ZIP&&this.result.ORDER_PROP.properties[k].ID==this.deliveryLocationInfo.zip){var h=this.result.ORDER_PROP.properties[k];for(b=0;b<e.length;b++)if(e[b]==h.ID){f=(f=BX("zipProperty"))&&f.value&&f.value.length?f.value:BX.message("SOA_NOT_SPECIFIED");break}}var k=this.getLocationString(this.regionHiddenBlockNode);
g&&k.length&&(d+=`<p>${BX.util.htmlspecialchars(k)}</p>`);h&&f.length&&(d+="<strong>"+BX.util.htmlspecialchars(h.NAME)+":</strong> "+BX.util.htmlspecialchars(f));a.innerHTML+=d;"true"==this.regionBlockNode.getAttribute("data-visited")&&(g=this.isValidRegionBlock(),g.length?(BX.addClass(this.regionBlockNode,"bx-step-error"),this.showError(this.regionBlockNode,g)):BX.removeClass(this.regionBlockNode,"bx-step-error"));console.log(d);BX.bind(a.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,
this));BX.bind(a.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))}},getSelectedPersonType:function(){var a;var b=this.result.PERSON_TYPE.length;1==b?(b=this.regionBlockNode.querySelector("input[type=hidden][name=PERSON_TYPE]"))||(b=this.regionHiddenBlockNode.querySelector("input[type=hidden][name=PERSON_TYPE]")):2==b?(b=this.regionBlockNode.querySelector("input[type=radio][name=PERSON_TYPE]:checked"))||(b=this.regionHiddenBlockNode.querySelector("input[type=radio][name=PERSON_TYPE]:checked")):
(b=this.regionBlockNode.querySelector("select[name=PERSON_TYPE] > option:checked"))||(b=this.regionHiddenBlockNode.querySelector("select[name=PERSON_TYPE] > option:checked"));if(b)for(a in b=b.value,this.result.PERSON_TYPE)if(this.result.PERSON_TYPE[a].ID==b){var c=this.result.PERSON_TYPE[a];break}return c},getDeliveryLocationInput:function(a){var b;for(h in this.result.ORDER_PROP.properties)if(this.result.ORDER_PROP.properties.hasOwnProperty(h)){var c=this.result.ORDER_PROP.properties[h];if("Y"==
c.IS_LOCATION){var d=c.ID;var e=parseInt(c.INPUT_FIELD_LOCATION);break}}if((b=this.locations[d])&&b[0]&&b[0].output){this.regionBlockNotEmpty=!0;var f='<label class="label" for="soa-property-'+parseInt(d)+'">'+("Y"==c.REQUIRED?'<span class="bx-authform-starrequired">*</span> ':"")+BX.util.htmlspecialchars(c.NAME)+(c.DESCRIPTION.length?" <small>("+BX.util.htmlspecialchars(c.DESCRIPTION)+")</small>":"")+"</label>";c=b[0].output;d=BX.create("DIV",{attrs:{"data-property-id-row":d},props:{className:"form-group profile__item"},
style:{visibility:"hidden"},html:f+c.HTML});a.appendChild(d);a.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"RECENT_DELIVERY_VALUE",value:b[0].lastValue}}));for(h in c.SCRIPT)c.SCRIPT.hasOwnProperty(h)&&BX.evalGlobal(c.SCRIPT[h].JS)}if(b&&b[0]&&b[0].showAlt&&0<e)for(h in this.result.ORDER_PROP.properties)if(parseInt(this.result.ORDER_PROP.properties[h].ID)==e){var g=this.result.ORDER_PROP.properties[h];break}if(g){e=BX.create("DIV",{attrs:{"data-property-id-row":g.ID},props:{className:"form-group bx-soa-location-input-container"}});
b="Y"==g.REQUIRED?'<span class="bx-authform-starrequired">*</span> ':"";b+=BX.util.htmlspecialchars(g.NAME);b=BX.create("LABEL",{attrs:{for:"altProperty"},props:{className:"bx-soa-custom-label"},html:b});var h=BX.create("INPUT",{props:{id:"altProperty",type:"text",placeholder:g.DESCRIPTION,autocomplete:"city",className:"form-control bx-soa-customer-input bx-ios-fix",name:"ORDER_PROP_"+g.ID,value:g.VALUE}});e.appendChild(b);e.appendChild(h);a.appendChild(e);this.bindValidation(g.ID,e)}this.getZipLocationInput(a)},
getLocationString:function(a){if(!a)return"";var b=a.querySelector(".bx-ui-sls-route"),c="",d;if(b&&b.value&&b.value.length)c=b.value;else{a=a.querySelectorAll(".bx-ui-combobox-fake.bx-combobox-fake-as-input");for(b=a.length;b--;)0<=a[b].innerHTML.indexOf("...")||(0<=a[b].innerHTML.indexOf("---")?(d=BX("altProperty"))&&d.value.length&&(c+=d.value):(c.length&&(c+=", "),c+=a[b].innerHTML));0==c.length&&(c=BX.message("SOA_NOT_SPECIFIED"))}return c},getZipLocationInput:function(a){for(c in this.result.ORDER_PROP.properties)if(this.result.ORDER_PROP.properties.hasOwnProperty(c)&&
"Y"==this.result.ORDER_PROP.properties[c].IS_ZIP){var b=this.result.ORDER_PROP.properties[c];break}if(b){this.regionBlockNotEmpty=!0;var c=BX.create("DIV",{props:{className:"form-group profile__item"}});c.setAttribute("data-property-id-row",b.ID);var d="Y"==b.REQUIRED?'<span class="bx-authform-starrequired">*</span> ':"";d+=BX.util.htmlspecialchars(b.NAME);d=BX.create("LABEL",{attrs:{"for":"zipProperty"},props:{className:"label"},html:d});var e=BX.create("INPUT",{props:{id:"zipProperty",type:"text",
placeholder:b.DESCRIPTION,autocomplete:"zip",className:"form-control input",name:"ORDER_PROP_"+b.ID,value:b.VALUE}});c.appendChild(d);c.appendChild(e);a.appendChild(c);a.appendChild(BX.create("input",{props:{id:"ZIP_PROPERTY_CHANGED",name:"ZIP_PROPERTY_CHANGED",type:"hidden",value:this.result.ZIP_PROPERTY_CHANGED||"N"}}));this.bindValidation(b.ID,c)}},getPersonTypeSortedArray:function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b.sort(function(d,e){return parseInt(d.SORT)-parseInt(e.SORT)})},
getPersonTypeControl:function(a){if(this.result.PERSON_TYPE){this.result.PERSON_TYPE=this.getPersonTypeSortedArray(this.result.PERSON_TYPE);var b=this.result.PERSON_TYPE.length,c,d=[],e=!1;if(1<b){var f=BX.create("DIV",{props:{className:"form-group"},children:[BX.create("LABEL",{props:{className:"bx-soa-custom-label"},html:this.params.MESS_PERSON_TYPE}),BX.create("BR")]});a.appendChild(f);a=f}if(2<b){for(c in this.result.PERSON_TYPE)if(this.result.PERSON_TYPE.hasOwnProperty(c)&&(b=this.result.PERSON_TYPE[c],
d.push(BX.create("OPTION",{props:{value:b.ID,selected:"Y"==b.CHECKED},text:b.NAME})),"Y"==b.CHECKED))var g=b.ID;a.appendChild(BX.create("SELECT",{props:{name:"PERSON_TYPE",className:"form-control"},children:d,events:{change:BX.proxy(this.sendRequest,this)}}));this.regionBlockNotEmpty=!0}else if(2==b){for(c in this.result.PERSON_TYPE)this.result.PERSON_TYPE.hasOwnProperty(c)&&(b=this.result.PERSON_TYPE[c],d=BX.create("LABEL",{children:[BX.create("INPUT",{attrs:{checked:"Y"==b.CHECKED},props:{type:"radio",
name:"PERSON_TYPE",value:b.ID}}),BX.util.htmlspecialchars(b.NAME)],events:{change:BX.proxy(this.sendRequest,this)}}),e&&a.appendChild(BX.create("BR")),a.appendChild(BX.create("DIV",{props:{className:"radio-inline"},children:[d]})),e=!0,"Y"==b.CHECKED&&(g=b.ID));this.regionBlockNotEmpty=!0}else for(c in this.result.PERSON_TYPE)this.result.PERSON_TYPE.hasOwnProperty(c)&&a.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"PERSON_TYPE",value:this.result.PERSON_TYPE[c].ID}}));g&&a.appendChild(BX.create("INPUT",
{props:{type:"hidden",name:"PERSON_TYPE_OLD",value:g}}))}},getProfilesControl:function(a){var b=BX.util.object_keys(this.result.USER_PROFILES).length,c=[];if(b)if("Y"===this.params.ALLOW_USER_PROFILES&&(1<b||"Y"===this.params.ALLOW_NEW_PROFILE)){this.regionBlockNotEmpty=!0;b=BX.create("LABEL",{props:{className:"bx-soa-custom-label"},html:this.params.MESS_SELECT_PROFILE});for(d in this.result.USER_PROFILES)this.result.USER_PROFILES.hasOwnProperty(d)&&c.unshift(BX.create("OPTION",{props:{value:this.result.USER_PROFILES[d].ID,
selected:"Y"===this.result.USER_PROFILES[d].CHECKED},html:this.result.USER_PROFILES[d].NAME}));"Y"===this.params.ALLOW_NEW_PROFILE&&c.unshift(BX.create("OPTION",{props:{value:0},text:BX.message("SOA_PROP_NEW_PROFILE")}));var d=BX.create("INPUT",{props:{type:"hidden",value:"N",id:"profile_change",name:"profile_change"}});c=BX.create("SELECT",{props:{className:"form-control",name:"PROFILE_ID"},children:c,events:{change:BX.delegate(function(){BX("profile_change").value="Y";this.sendRequest()},this)}});
a.appendChild(BX.create("DIV",{props:{className:"form-group bx-soa-location-input-container"},children:[b,d,c]}))}else for(d in this.result.USER_PROFILES)this.result.USER_PROFILES.hasOwnProperty(d)&&"Y"===this.result.USER_PROFILES[d].CHECKED&&a.appendChild(BX.create("INPUT",{props:{name:"PROFILE_ID",type:"hidden",value:this.result.USER_PROFILES[d].ID}}))},editPaySystemBlock:function(a){this.paySystemBlockNode&&this.paySystemHiddenBlockNode&&this.result.PAY_SYSTEM&&(a?this.editActivePaySystemBlock(!0):
this.editFadePaySystemBlock(),this.initialized.paySystem=!0)},editActivePaySystemBlock:function(a){var b=a?this.paySystemBlockNode:this.paySystemHiddenBlockNode;this.initialized.paySystem?(BX.remove(BX.lastChild(b)),b.appendChild(BX.firstChild(this.paySystemHiddenBlockNode))):((a=b.querySelector(".bx-soa-section-content"))?BX.cleanNode(a):(a=this.getNewContainer(),b.appendChild(a)),this.getErrorContainer(a),b=BX.create("DIV",{props:{className:"bx-soa-pp row"}}),this.editPaySystemItems(b),a.appendChild(b),
"Y"==this.params.SHOW_COUPONS_PAY_SYSTEM&&this.editCoupons(a),this.getBlockFooter(a))},editFadePaySystemBlock:function(){var a=this.paySystemBlockNode.querySelector(".bx-soa-section-content");this.initialized.paySystem?this.paySystemHiddenBlockNode.appendChild(a):(this.editActivePaySystemBlock(!1),BX.remove(BX.lastChild(this.paySystemBlockNode)));a=this.getNewContainer(!0);this.paySystemBlockNode.appendChild(a);this.editFadePaySystemContent(a);"Y"==this.params.SHOW_COUPONS_PAY_SYSTEM&&this.editCouponsFade(a)},
editPaySystemItems:function(a){if(this.result.PAY_SYSTEM&&!(0>=this.result.PAY_SYSTEM.length)){var b=BX.create("DIV",{props:{className:"col-sm-7 bx-soa-pp-item-container order__methods"}}),c;for(c=0;c<this.paySystemPagination.currentPage.length;c++){var d=this.createPaySystemItem(this.paySystemPagination.currentPage[c]);b.appendChild(d)}this.paySystemPagination.show&&this.showPagination("paySystem",b);a.appendChild(b)}},createPaySystemItem:function(a){var b="Y"==a.CHECKED,c,d=parseInt(a.ID),e;var f=
BX.create("DIV",{props:{className:"bx-soa-pp-company-image"}});(c=this.getImageSources(a,"PSA_LOGOTIP"))&&c.src_2x?f.setAttribute("style",'background-image: url("'+c.src_1x+'");background-image: -webkit-image-set(url("'+c.src_1x+'") 1x, url("'+c.src_2x+'") 2x)'):(c=c&&c.src_1x||this.defaultPaySystemLogo,f.setAttribute("style",'background-image: url("'+c+'");'));c=BX.create("INPUT",{props:{id:"ID_PAY_SYSTEM_ID_"+d,name:"PAY_SYSTEM_ID",type:"checkbox",className:"bx-soa-pp-company-checkbox radio",value:d,
checked:b}});"Y"==this.params.SHOW_PAY_SYSTEM_LIST_NAMES&&(e=BX.create("SPAN",{props:{className:"bx-soa-pp-company-smalltitle method__name"},text:a.NAME}));a=BX.create("SPAN",{props:{className:"method__radio"}});e=BX.create("LABEL",{props:{className:"bx-soa-pp-company order__method method"},children:[c,e,a],events:{click:BX.proxy(this.selectPaySystem,this)}});b&&BX.addClass(e,"bx-selected active");return e},editPaySystemInfo:function(a){if(this.result.PAY_SYSTEM&&(0!=this.result.PAY_SYSTEM.length||
"Y"==this.result.PAY_FROM_ACCOUNT)){var b=BX.create("DIV",{props:{className:(0==this.result.PAY_SYSTEM.length?"col-sm-12":"col-sm-5")+" bx-soa-pp-desc-container"}}),c,d,e,f,g,h;BX.cleanNode(b);"Y"==this.result.PAY_FROM_ACCOUNT&&(c=this.getInnerPaySystem(b));if(f=this.getSelectedPaySystem()){var k=BX.create("DIV",{props:{className:"bx-soa-pp-company-image"}});(d=this.getImageSources(f,"PSA_LOGOTIP"))&&d.src_2x?k.setAttribute("style",'background-image: url("'+d.src_1x+'");background-image: -webkit-image-set(url("'+
d.src_1x+'") 1x, url("'+d.src_2x+'") 2x)'):(d=d&&d.src_1x||this.defaultPaySystemLogo,k.setAttribute("style",'background-image: url("'+d+'");'));"Y"==this.params.SHOW_PAY_SYSTEM_INFO_NAME&&(g=BX.create("DIV",{props:{className:"bx-soa-pp-company-subTitle"},text:f.NAME}));d=BX.create("DIV",{props:{className:"bx-soa-pp-company-logo"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-graf-container"},children:[k]})]});k=BX.create("DIV",{props:{className:"bx-soa-pp-company-block"},children:[BX.create("DIV",
{props:{className:"bx-soa-pp-company-desc"},html:f.DESCRIPTION})]});f.PRICE&&0<parseFloat(f.PRICE)&&(h=BX.create("UL",{props:{className:"bx-soa-pp-list"},children:[BX.create("LI",{children:[BX.create("DIV",{props:{className:"bx-soa-pp-list-termin"},html:this.params.MESS_PRICE+":"}),BX.create("DIV",{props:{className:"bx-soa-pp-list-description"},text:"~"+f.PRICE_FORMATTED})]})]}));d=BX.create("DIV",{children:[g,d,k,h]})}c&&d&&(e=BX.create("HR",{props:{className:"bxe-light"}}));b.appendChild(BX.create("LABEL",
{props:{className:"bx-soa-pp-company order__method method"},children:[c,e,d]}));a.appendChild(b)}},getInnerPaySystem:function(){if(this.result.CURRENT_BUDGET_FORMATED&&this.result.PAY_CURRENT_ACCOUNT&&this.result.INNER_PAY_SYSTEM){var a=this.params.ONLY_FULL_PAY_FROM_ACCOUNT&&"Y"==this.params.ONLY_FULL_PAY_FROM_ACCOUNT,b=this.result.PAY_CURRENT_ACCOUNT&&"Y"==this.result.PAY_CURRENT_ACCOUNT,c=this.result.INNER_PAY_SYSTEM,d,e,f;"Y"==this.params.SHOW_PAY_SYSTEM_INFO_NAME&&(e=BX.create("DIV",{props:{className:"bx-soa-pp-company-subTitle"},
text:c.NAME}));var g=BX.create("DIV",{props:{className:"bx-soa-pp-company-image"}});(d=this.getImageSources(c,"LOGOTIP"))&&d.src_2x?g.setAttribute("style",'background-image: url("'+d.src_1x+'");background-image: -webkit-image-set(url("'+d.src_1x+'") 1x, url("'+d.src_2x+'") 2x)'):(d=d&&d.src_1x||this.defaultPaySystemLogo,g.setAttribute("style",'background-image: url("'+d+'");'));d=BX.create("DIV",{props:{className:"bx-soa-pp-company-logo"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-graf-container"},
children:[BX.create("INPUT",{props:{type:"checkbox",className:"bx-soa-pp-company-checkbox radio",name:"PAY_CURRENT_ACCOUNT",value:"Y",checked:b}}),g],events:{click:BX.proxy(this.selectPaySystem,this)}})]});c.DESCRIPTION&&c.DESCRIPTION.length&&(f=BX.create("DIV",{props:{className:"bx-soa-pp-company-block"},children:[BX.create("DIV",{props:{className:"bx-soa-pp-company-desc"},html:c.DESCRIPTION})]}));c=BX.create("INPUT",{props:{type:"hidden",name:"PAY_CURRENT_ACCOUNT",value:"N"}});a=this.params.MESS_INNER_PS_BALANCE+
' <b class="wsnw">'+this.result.CURRENT_BUDGET_FORMATED+"</b><br>"+(a?BX.message("SOA_PAY_ACCOUNT3"):"");a=BX.create("DIV",{props:{className:"bx-soa-pp-company-desc"},html:a});return BX.create("DIV",{props:{className:"bx-soa-pp-inner-ps"+(b?" bx-selected":"")},children:[c,e,d,f,a]})}},editFadePaySystemContent:function(a){var b=this.getSelectedPaySystem(),c=this.paySystemHiddenBlockNode.querySelector("div.alert.alert-danger"),d=this.paySystemHiddenBlockNode.querySelector("div.alert.alert-warning.alert-show"),
e="";c?a.appendChild(c.cloneNode(!0)):this.getErrorContainer(a);d&&d.innerHTML&&a.appendChild(d.cloneNode(!0));this.isSelectedInnerPayment()&&(this.getImageSources(this.result.INNER_PAY_SYSTEM,"LOGOTIP"),e+="<span>"+this.result.INNER_PAY_SYSTEM.NAME+"</span>");b&&b.NAME&&(this.getImageSources(b,"PSA_LOGOTIP"),e+="<span>"+BX.util.htmlspecialchars(b.NAME)+"</span>");e.length||(e="<strong>"+BX.message("SOA_PS_SELECT_ERROR")+"</strong>");a.innerHTML+=`<p>${e}</p>`;a.appendChild(BX.create("DIV",{style:{clear:"both"}}));
BX.bind(a.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,this));BX.bind(a.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))},getSelectedPaySystem:function(){var a=this.paySystemBlockNode.querySelector("input[type=checkbox][name=PAY_SYSTEM_ID]:checked"),b=null,c;a||=this.paySystemHiddenBlockNode.querySelector("input[type=checkbox][name=PAY_SYSTEM_ID]:checked");a||=this.paySystemHiddenBlockNode.querySelector("input[type=hidden][name=PAY_SYSTEM_ID]");
if(a)for(a=a.value,c=0;c<this.result.PAY_SYSTEM.length;c++)if(this.result.PAY_SYSTEM[c].ID==a){b=this.result.PAY_SYSTEM[c];break}return b},isSelectedInnerPayment:function(){var a=this.paySystemBlockNode.querySelector("input[type=checkbox][name=PAY_CURRENT_ACCOUNT]");a||=this.paySystemHiddenBlockNode.querySelector("input[type=checkbox][name=PAY_CURRENT_ACCOUNT]");return a&&a.checked},selectPaySystem:function(a){if(this.orderBlockNode&&a){var b=a.target||a.srcElement,c=this.paySystemBlockNode.querySelector("div.bx-soa-pp-inner-ps"),
d=this.paySystemBlockNode.querySelector("input[type=checkbox][name=PAY_CURRENT_ACCOUNT]"),e=this.result.TOTAL&&0===parseFloat(this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY),f=BX.hasClass(b,"bx-soa-pp-inner-ps")?b:BX.findParent(b,{className:"bx-soa-pp-inner-ps"}),g=BX.hasClass(b,"bx-soa-pp-company")?b:BX.findParent(b,{className:"bx-soa-pp-company"});if(f)"INPUT"==b.nodeName&&(d.checked=!d.checked),d.checked?(BX.removeClass(c,"bx-selected"),d.checked=!1):(BX.addClass(c,"bx-selected"),d.checked=!0);else if(g){if(BX.hasClass(g,
"bx-selected"))return BX.PreventDefault(a);d&&d.checked&&e?(BX.addClass(g,"bx-selected"),g=g.querySelector("input[type=checkbox]"),g.checked=!0,BX.removeClass(c,"bx-selected"),d.checked=!1):(c=this.paySystemBlockNode.querySelector(".bx-soa-pp-company.bx-selected"),BX.addClass(g,"bx-selected"),g=g.querySelector("input[type=checkbox]"),g.checked=!0,c&&(BX.removeClass(c,"bx-selected"),c.querySelector("input[type=checkbox]").checked=!1))}this.sendRequest()}},editDeliveryBlock:function(a){this.deliveryBlockNode&&
this.deliveryHiddenBlockNode&&this.result.DELIVERY&&(a?this.editActiveDeliveryBlock(!0):this.editFadeDeliveryBlock(),this.checkPickUpShow(),this.initialized.delivery=!0)},editActiveDeliveryBlock:function(a){var b=a?this.deliveryBlockNode:this.deliveryHiddenBlockNode,c;var d=this.getSelectedDelivery();this.initialized.delivery?(BX.remove(BX.lastChild(b)),b.appendChild(BX.firstChild(this.deliveryHiddenBlockNode))):((a=b.querySelector(".bx-soa-section-content"))?BX.cleanNode(a):(a=this.getNewContainer(),
b.appendChild(a)),this.getErrorContainer(a),b=BX.create("DIV",{props:{className:"bx-soa-pp row"}}),this.editDeliveryItems(b),a.appendChild(b),!d&&(c=document.querySelector("[name=DELIVERY_ID]").value)&&(d=this.getDelivetyById(c)),d.STORE.length&&this.editDeliveryPickUpInfo(b),"Y"==this.params.SHOW_COUPONS_DELIVERY&&this.editCoupons(a),this.getBlockFooter(a))},editDeliveryItems:function(a){if(this.result.DELIVERY&&!(0>=this.result.DELIVERY.length)){var b=BX.create("DIV",{props:{className:"col-sm-7 bx-soa-pp-item-container order__methods"}}),
c;for(c=0;c<this.deliveryPagination.currentPage.length;c++){var d=this.createDeliveryItem(this.deliveryPagination.currentPage[c]);b.appendChild(d)}this.deliveryPagination.show&&this.showPagination("delivery",b);a.appendChild(b)}},editDeliveryPickUpInfo:function(a){if(this.result.DELIVERY){var b=BX.create("DIV",{props:{className:"col-sm-5 bx-soa-pp-desc-container"}});BX.cleanNode(b);var c=this.getSelectedDelivery();var d=this.getPickUpInfoArray([c.STORE[0]])[0];d.ADDRESS&&b.appendChild(BX.create("P",
{html:`<strong>${BX.message("SOA_PICKUP_ADDRESS")}:</strong> `+d.ADDRESS}));d.GPS_N&&d.GPS_S&&(b.appendChild(BX.create("P",{children:[BX.create("A",{text:BX.message("SOA_PICKUP_ON_THE_MAP"),props:{href:"javascript:void(0)",className:"link"},events:{click:BX.proxy(this.showPickUpMap,this)}})]})),b.appendChild(BX.create("DIV",{props:{id:"pickUpMap",className:"dev-hide"}})));a.appendChild(b);"Y"!=this.params.DELIVERY_NO_AJAX&&(this.deliveryCachedInfo[c.ID]=c)}},showPickUpMap:function(){let a=BX("pickUpMap");
a&&BX.removeClass(a,"dev-hide");return!1},getDeliveryPriceNodes:function(a){return"undefined"!==typeof a.DELIVERY_DISCOUNT_PRICE&&parseFloat(a.DELIVERY_DISCOUNT_PRICE)!=parseFloat(a.PRICE)?parseFloat(a.DELIVERY_DISCOUNT_PRICE)>parseFloat(a.PRICE)?[a.DELIVERY_DISCOUNT_PRICE_FORMATED]:[a.DELIVERY_DISCOUNT_PRICE_FORMATED,BX.create("BR"),BX.create("SPAN",{props:{className:"bx-price-old"},html:a.PRICE_FORMATED})]:[a.PRICE_FORMATED]},getDeliveryExtraServices:function(a){var b=[],c=!1,d;for(d in a.EXTRA_SERVICES)if(a.EXTRA_SERVICES.hasOwnProperty(d)){var e=
a.EXTRA_SERVICES[d];if(e.canUserEditValue){if(-1==e.editControl.indexOf("this.checked")){var f=BX.create("LABEL",{html:BX.util.htmlspecialchars(e.name)+(e.price?" ("+e.priceFormatted+")":"")});0==d&&(c=!0);e=BX.create("DIV",{props:{className:"form-group bx-soa-pp-field"},html:e.editControl+(e.description&&e.description.length?'<div class="bx-soa-service-small">'+BX.util.htmlspecialchars(e.description)+"</div>":"")});BX.prepend(f,e);(f=e.querySelector("input[type=text]"))||(f=e.querySelector("select"));
f&&BX.addClass(f,"form-control")}else e=BX.create("DIV",{props:{className:"checkbox"},children:[BX.create("LABEL",{html:e.editControl+BX.util.htmlspecialchars(e.name)+(e.price?" ("+e.priceFormatted+")":"")+(e.description&&e.description.length?'<div class="bx-soa-service-small">'+BX.util.htmlspecialchars(e.description)+"</div>":"")})]});b.push(e)}}c&&b.unshift(BX.create("BR"));return b},editFadeDeliveryBlock:function(){var a=this.deliveryBlockNode.querySelector(".bx-soa-section-content");this.initialized.delivery?
this.deliveryHiddenBlockNode.appendChild(a):(this.editActiveDeliveryBlock(!1),BX.remove(BX.lastChild(this.deliveryBlockNode)));a=this.getNewContainer(!0);BX.addClass(a,"d-flex");this.deliveryBlockNode.appendChild(a);this.editFadeDeliveryContent(a);"Y"==this.params.SHOW_COUPONS_DELIVERY&&this.editCouponsFade(a)},createDeliveryItem:function(a){var b="Y"==a.CHECKED,c=parseInt(a.ID),d=[BX.create("INPUT",{props:{id:"ID_DELIVERY_ID_"+c,name:"DELIVERY_ID",type:"checkbox",className:"bx-soa-pp-company-checkbox radio",
value:c,checked:b}})],e=this.deliveryCachedInfo[c];if("Y"==this.params.SHOW_DELIVERY_LIST_NAMES){var f=BX.create("SPAN",{props:{className:"bx-soa-pp-company-smalltitle method__name"},text:"N"!=this.params.SHOW_DELIVERY_PARENT_NAMES?a.NAME:a.OWN_NAME});d.push(f)}0<=a.PRICE||"undefined"!==typeof a.DELIVERY_DISCOUNT_PRICE?d.push(BX.create("DIV",{props:{className:"bx-soa-pp-delivery-cost"},html:this.getPricePrint("undefined"!==typeof a.DELIVERY_DISCOUNT_PRICE?a.DELIVERY_DISCOUNT_PRICE_FORMATED:a.PRICE_FORMATED)})):
e&&(0<=e.PRICE||"undefined"!==typeof e.DELIVERY_DISCOUNT_PRICE)&&d.push(BX.create("DIV",{props:{className:"bx-soa-pp-delivery-cost"},html:this.getPricePrint("undefined"!==typeof e.DELIVERY_DISCOUNT_PRICE?e.DELIVERY_DISCOUNT_PRICE_FORMATED:e.PRICE_FORMATED)}));BX.create("DIV",{props:{className:"bx-soa-pp-company-graf-container"+(a.CALCULATE_ERRORS||e&&e.CALCULATE_ERRORS?" bx-bd-waring":"")},children:d});a=BX.create("SPAN",{props:{className:"method__radio"}});d.push(a);d=BX.create("LABEL",{props:{className:"bx-soa-pp-company order__method method"},
children:d,events:{click:BX.proxy(this.selectDelivery,this)}});b&&BX.addClass(d,"bx-selected active");b&&this.result.LAST_ORDER_DATA.PICK_UP&&(this.lastSelectedDelivery=c);return d},getPricePrint(a){return a.indexOf("0 ")?a:BX.message("SOA_FREE_TITLE")},editFadeDeliveryContent:function(a){var b=this.getSelectedDelivery(),c="N"!=this.params.SHOW_DELIVERY_PARENT_NAMES?b.NAME:b.OWN_NAME,d=this.deliveryHiddenBlockNode.querySelector("div.alert.alert-danger"),e=this.deliveryHiddenBlockNode.querySelector("div.alert.alert-warning.alert-show"),
f;d&&d.innerHTML?a.appendChild(d.cloneNode(!0)):this.getErrorContainer(a);e&&e.innerHTML&&a.appendChild(e.cloneNode(!0));if(b&&b.NAME){this.getImageSources(b,"LOGOTIP");d=[BX.create("SPAN",{text:`${c}: `})];if("Y"==this.params.DELIVERY_FADE_EXTRA_SERVICES&&BX.util.object_keys(b.EXTRA_SERVICES).length)for(f in d.push(BX.create("BR")),b.EXTRA_SERVICES)b.EXTRA_SERVICES.hasOwnProperty(f)&&(c=b.EXTRA_SERVICES[f],c.value&&"N"!=c.value&&c.canUserEditValue&&(d.push(BX.create("BR")),d.push(BX.create("STRONG",
{text:c.name+": "})),d.push(c.viewControl)));a.appendChild(BX.create("DIV",{props:{className:"col-sm-9 bx-soa-pp-company-selected"},children:d}));a.appendChild(BX.create("DIV",{props:{className:"col-sm-3 bx-soa-pp-price"},children:this.getPricePrint(this.getDeliveryPriceNodes(b)[0])}))}else a.appendChild(BX.create("STRONG",{text:BX.message("SOA_DELIVERY_SELECT_ERROR")}));a.appendChild(BX.create("DIV",{style:{clear:"both"}}));BX.bind(a.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,
this));BX.bind(a.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))},selectDelivery:function(a){if(this.orderBlockNode){var b=a.target||a.srcElement,c=BX.hasClass(b,"bx-soa-pp-company")?b:BX.findParent(b,{className:"bx-soa-pp-company"});b=this.deliveryBlockNode.querySelector(".bx-soa-pp-company.bx-selected");if(BX.hasClass(c,"bx-selected"))return BX.PreventDefault(a);c&&(a=c.querySelector("input[type=checkbox]"),BX.addClass(c,"bx-selected"),a.checked=!0);b&&(a=b.querySelector("input[type=checkbox]"),
BX.removeClass(b,"bx-selected"),a.checked=!1);this.sendRequest()}},getSelectedDelivery:function(){var a=this.deliveryBlockNode.querySelector("input[type=checkbox][name=DELIVERY_ID]:checked"),b=!1;a||=this.deliveryHiddenBlockNode.querySelector("input[type=checkbox][name=DELIVERY_ID]:checked");a||=this.deliveryHiddenBlockNode.querySelector("input[type=hidden][name=DELIVERY_ID]");a&&(b=this.getDelivetyById(a.value));return b},getDelivetyById(a){let b=null;if(!a)return null;for(let c in this.result.DELIVERY)if(this.result.DELIVERY[c].ID==
a){b=this.result.DELIVERY[c];break}return b},activatePickUp:function(a){this.pickUpBlockNode&&this.pickUpHiddenBlockNode&&(this.pickUpBlockNode.style.display="",this.pickUpBlockNode.querySelector(".order__title").innerHTML='<span class="bx-soa-section-title-count"></span>'+BX.util.htmlspecialchars(a),BX.hasClass(this.pickUpBlockNode,"bx-active")||(BX.addClass(this.pickUpBlockNode,"bx-active"),this.pickUpBlockNode.style.display=""))},deactivatePickUp:function(){this.pickUpBlockNode&&this.pickUpHiddenBlockNode&&
BX.hasClass(this.pickUpBlockNode,"bx-active")&&(BX.removeClass(this.pickUpBlockNode,"bx-active"),this.pickUpBlockNode.style.display="none")},editPickUpBlock:function(a){this.pickUpBlockNode&&this.pickUpHiddenBlockNode&&BX.hasClass(this.pickUpBlockNode,"bx-active")&&this.result.DELIVERY&&(this.initialized.pickup=!1,a&&this.editActivePickUpBlock(!0),this.initialized.pickup=!0)},editActivePickUpBlock:function(a){var b=a?this.pickUpBlockNode:this.pickUpHiddenBlockNode;if(this.initialized.pickup)BX.remove(BX.lastChild(b)),
b.appendChild(BX.firstChild(this.pickUpHiddenBlockNode)),"Y"===this.params.SHOW_NEAREST_PICKUP&&this.maps&&!this.maps.maxWaitTimeExpired&&(this.maps.maxWaitTimeExpired=!0,this.initPickUpPagination(),this.editPickUpList(!0),this.pickUpFinalAction()),this.maps&&!this.pickUpMapFocused&&(this.pickUpMapFocused=!0,setTimeout(BX.proxy(this.maps.pickUpMapFocusWaiter,this.maps),200));else{a=b.querySelector(".bx-soa-section-content");a||(a=this.getNewContainer(),b.appendChild(a));BX.cleanNode(a);b=BX.create("DIV",
{props:{className:"col-xs-12"}});this.editPickUpMap(b);this.editPickUpLoader(b);a.appendChild(BX.create("DIV",{props:{className:"bx_soa_pickup row"},children:[b]}));if("Y"!=this.params.SHOW_PICKUP_MAP||"Y"!=this.params.SHOW_NEAREST_PICKUP)this.initPickUpPagination(),this.editPickUpList(!0),this.pickUpFinalAction();this.getBlockFooter(a)}},editFadePickUpBlock:function(){var a=this.pickUpBlockNode.querySelector(".bx-soa-section-content");this.initialized.pickup?this.pickUpHiddenBlockNode.appendChild(a):
(this.editActivePickUpBlock(!1),BX.remove(BX.lastChild(this.pickUpBlockNode)));a=this.getNewContainer();this.pickUpBlockNode.appendChild(a);this.editFadePickUpContent(a)},editFadePickUpContent:function(a){var b=this.getSelectedPickUp(),c="";if(b){if("Y"==this.params.SHOW_STORES_IMAGES){var d=this.getImageSources(b,"IMAGE_ID");var e=d.src_1x||this.defaultStoreLogo;c+='<img src="'+e+'" class="bx-soa-pickup-preview-img">'}c+="<strong>"+BX.util.htmlspecialchars(b.TITLE)+"</strong>";b.ADDRESS&&(c+="<br><strong>"+
BX.message("SOA_PICKUP_ADDRESS")+":</strong> "+BX.util.htmlspecialchars(b.ADDRESS));b.PHONE&&(c+="<br><strong>"+BX.message("SOA_PICKUP_PHONE")+":</strong> "+BX.util.htmlspecialchars(b.PHONE));b.SCHEDULE&&(c+="<br><strong>"+BX.message("SOA_PICKUP_WORK")+":</strong> "+BX.util.htmlspecialchars(b.SCHEDULE));b.DESCRIPTION&&(c+="<br><strong>"+BX.message("SOA_PICKUP_DESC")+":</strong> "+BX.util.htmlspecialchars(b.DESCRIPTION));a.innerHTML=c;"Y"==this.params.SHOW_STORES_IMAGES&&BX.bind(a.querySelector(".bx-soa-pickup-preview-img"),
"click",BX.delegate(function(f){this.popupShow(f,d&&d.src_orig||e)},this))}},getPickUpInfoArray:function(a){if(!a||0>=a.length)return[];var b=[],c;for(c=0;c<a.length;c++)this.result.STORE_LIST[a[c]]&&b.push(this.result.STORE_LIST[a[c]]);return b},getSelectedPickUp:function(){var a=BX("BUYER_STORE"),b=this.result.STORE_LIST,c,d;if(a){var e=a.value;e=b[e];if(!e&&(c=this.getSelectedDelivery().STORE))for(d in c)if(c.hasOwnProperty(d)){e=b[c[d]];a.setAttribute("value",c[d]);break}}return e},checkPickUpShow:function(){var a=
this.getSelectedDelivery(),b;a&&a.STORE&&a.STORE.length&&(b=this.getPickUpInfoArray(a.STORE));b&&b.length?(b="N"!=this.params.SHOW_DELIVERY_PARENT_NAMES?a.NAME:a.OWN_NAME,a.STORE_MAIN=a.STORE,this.activatePickUp(b),this.editSection(this.pickUpBlockNode)):this.deactivatePickUp()},geoLocationSuccessCallback:function(a){var b,c=this.getSelectedDelivery();c&&c.STORE&&(b=this.getPickUpInfoArray(c.STORE));b&&b.length>=this.options.pickUpMap.minToShowNearestBlock&&this.editPickUpRecommendList(a.geoObjects.get(0));
this.initPickUpPagination();this.editPickUpList(!0);this.pickUpFinalAction()},geoLocationFailCallback:function(){this.initPickUpPagination();this.editPickUpList(!0);this.pickUpFinalAction()},initMaps:function(){if(this.maps=BX.Sale.OrderAjaxComponent.Maps.init(this)){this.mapsReady=!0;this.resizeMapContainers();if("Y"===this.params.SHOW_PICKUP_MAP&&BX("pickUpMap")){var a=this.getSelectedDelivery();if(a&&a.STORE&&a.STORE.length)var b=this.getPickUpInfoArray(a.STORE);b&&b.length&&(a=this.getSelectedPickUp(),
this.maps.initializePickUpMap(a),"Y"===this.params.SHOW_NEAREST_PICKUP&&this.maps.showNearestPickups(BX.proxy(this.geoLocationSuccessCallback,this),BX.proxy(this.geoLocationFailCallback,this)),this.maps.buildBalloons(b))}"Y"===this.params.SHOW_MAP_IN_PROPS&&BX("propsMap")&&(b=this.getPropertyMapData(),this.maps.initializePropsMap(b))}},getPropertyMapData:function(){var a,b=this.options.propertyMap.defaultMapPosition;for(a in this.result.ORDER_PROP.properties)if(this.result.ORDER_PROP.properties.hasOwnProperty(a)){var c=
this.result.ORDER_PROP.properties[a];if("Y"==c.IS_LOCATION){var d=c.ID;break}}this.locations[d]&&this.locations[d][0]&&this.locations[d][0].coordinates&&(c=this.locations[d][0].coordinates,d=parseFloat(c.LONGITUDE),c=parseFloat(c.LATITUDE),isNaN(d)||isNaN(c)||0==d||0==c||(b.lon=d,b.lat=c));return b},resizeMapContainers:function(){var a=BX("pickUpMap"),b=BX("propsMap"),c=this.propsBlockNode;c&&(a||b)&&(c=c.clientWidth,c=SC.isMobile()?parseInt(1.5*c):parseInt(c/16*9),"Y"===this.params.SHOW_PICKUP_MAP&&
a&&(a.style.height=c+"px"),"Y"===this.params.SHOW_MAP_IN_PROPS&&b&&(b.style.height=c+"px"))},editPickUpMap:function(a){a.appendChild(BX.create("DIV",{props:{id:"pickUpMap"},style:{width:"100%",marginBottom:"10px"}}))},editPickUpLoader:function(a){a.appendChild(BX.create("DIV",{props:{id:"pickUpLoader",className:"text-center"},children:[BX.create("IMG",{props:{src:this.templateFolder+"/images/loader.gif"}})]}))},editPickUpList:function(a){if(this.pickUpPagination.currentPage&&this.pickUpPagination.currentPage.length){BX.remove(BX("pickUpLoader"));
var b=BX.create("DIV",{props:{className:"bx-soa-pickup-list main"}}),c=BX("BUYER_STORE"),d,e=!1,f;if(c)var g=c.value;(d=this.pickUpBlockNode.querySelector(".bx-soa-pickup-list.recommend"))||(d=this.pickUpHiddenBlockNode.querySelector(".bx-soa-pickup-list.recommend"));if(d&&d.querySelector(".bx-soa-pickup-list-item.bx-selected"))e=!0;else if((f=this.getSelectedDelivery())&&f.STORE)for(d=0;d<f.STORE.length;d++)f.STORE[d]==g&&(e=!0);for(d=0;d<this.pickUpPagination.currentPage.length;d++)f=this.pickUpPagination.currentPage[d],
f.ID!=g&&0!=parseInt(g)&&e||(g=c.value=f.ID,e=!0),f=this.createPickUpItem(f,{selected:f.ID==g}),b.appendChild(f);a?((a=this.pickUpHiddenBlockNode.querySelector(".bx_soa_pickup>.col-xs-12"))||(a=this.pickUpBlockNode.querySelector(".bx_soa_pickup>.col-xs-12")),a.appendChild(BX.create("DIV",{props:{className:"bx-soa-pickup-subTitle"},html:this.params.MESS_PICKUP_LIST})),a.appendChild(b)):(a=this.pickUpBlockNode.querySelector(".bx-soa-pickup-list.main"),BX.insertAfter(b,a),BX.remove(a));this.pickUpPagination.show&&
this.showPagination("pickUp",b)}},pickUpFinalAction:function(){var a=this.getSelectedDelivery();if(a){var b=this.lastSelectedDelivery!==parseInt(a.ID);this.lastSelectedDelivery=parseInt(a.ID)}b&&this.pickUpBlockNode.id!==this.activeSectionId&&(this.pickUpBlockNode.id!==this.activeSectionId&&this.editFadePickUpContent(BX.lastChild(this.pickUpBlockNode)),BX.removeClass(this.pickUpBlockNode,"bx-step-completed"));this.maps&&this.maps.pickUpFinalAction()},getStoreInfoHtml:function(a){var b="";a.ADDRESS&&
(b+=BX.message("SOA_PICKUP_ADDRESS")+": "+BX.util.htmlspecialchars(a.ADDRESS)+"<br>");a.PHONE&&(b+=BX.message("SOA_PICKUP_PHONE")+": "+BX.util.htmlspecialchars(a.PHONE)+"<br>");a.SCHEDULE&&(b+=BX.message("SOA_PICKUP_WORK")+": "+BX.util.htmlspecialchars(a.SCHEDULE)+"<br>");a.DESCRIPTION&&(b+=BX.message("SOA_PICKUP_DESC")+": "+BX.util.htmlspecialchars(a.DESCRIPTION)+"<br>");return b},createPickUpItem:function(a,b){b=b||{};var c="bx-soa-pickup-l-item-detail",d="bx-soa-pickup-l-item-btn",e;if("Y"===this.params.SHOW_STORES_IMAGES){var f=
(e=this.getImageSources(a,"IMAGE_ID"))&&e.src_1x||this.defaultStoreLogo;var g=BX.create("IMG",{props:{src:f,className:"bx-soa-pickup-l-item-img"},events:{click:BX.delegate(function(k){this.popupShow(k,e&&e.src_orig||f)},this)}})}else c+=" no-image",d+=" no-image";var h=this.getStoreInfoHtml(a);a=BX.create("DIV",{props:{className:"bx-soa-pickup-list-item",id:"store-"+a.ID},children:[BX.create("DIV",{props:{className:"bx-soa-pickup-l-item-adress"},children:b.distance?[BX.util.htmlspecialchars(a.ADDRESS),
" ( ~"+b.distance+" "+BX.message("SOA_DISTANCE_KM")+" ) "]:[BX.util.htmlspecialchars(a.ADDRESS)]}),BX.create("DIV",{props:{className:c},children:[g,BX.create("DIV",{props:{className:"bx-soa-pickup-l-item-name"},text:a.TITLE}),BX.create("DIV",{props:{className:"bx-soa-pickup-l-item-desc"},html:h})]}),BX.create("DIV",{props:{className:d},children:[BX.create("A",{props:{href:"",className:"btn btn-sm btn-default"},html:this.params.MESS_SELECT_PICKUP,events:{click:BX.delegate(function(k){this.selectStore(k);
this.clickNextAction(k)},this)}})]})],events:{click:BX.proxy(this.selectStore,this)}});b.selected&&BX.addClass(a,"bx-selected");return a},editPickUpRecommendList:function(a){if(this.maps&&this.maps.canUseRecommendList()&&a){BX.remove(BX("pickUpLoader"));var b=BX.create("DIV",{props:{className:"bx-soa-pickup-list recommend"}}),c=BX("BUYER_STORE"),d=this.getSelectedDelivery(),e,f=this.maps.getRecommendedStoreIds(a);for(e=0;e<f.length;e++){var g=f[e];var h=this.getPickUpInfoArray([g])[0];0===e&&parseInt(d.ID)!==
this.lastSelectedDelivery&&(c.value=parseInt(g));var k=this.maps.getDistance(a,g);h=this.createPickUpItem(h,{selected:c.value===g,distance:k});b.appendChild(h);d.STORE_MAIN&&d.STORE_MAIN.splice(d.STORE_MAIN.indexOf(g),1)}(a=this.pickUpHiddenBlockNode.querySelector(".bx_soa_pickup>.col-xs-12"))||(a=this.pickUpBlockNode.querySelector(".bx_soa_pickup>.col-xs-12"));a.appendChild(BX.create("DIV",{props:{className:"bx-soa-pickup-subTitle"},html:this.params.MESS_NEAREST_PICKUP_LIST}));a.appendChild(b)}},
selectStore:function(a){var b=BX("BUYER_STORE"),c,d;if(BX.type.isString(a)){var e=BX("store-"+a);if(!e){for(c=0;c<this.pickUpPagination.pages.length;c++){var f=this.pickUpPagination.pages[c];for(d=0;d<f.length;d++)if(f[d].ID==a){this.showPickUpItemsPage(++c);break}}e=BX("store-"+a)}}else a=a.target||a.srcElement,e=BX.hasClass(a,"bx-soa-pickup-list-item")?a:BX.findParent(a,{className:"bx-soa-pickup-list-item"});e&&b&&!BX.hasClass(e,"bx-selected")&&(c=this.pickUpBlockNode.querySelector(".bx-selected"),
a=e.id.substr(6),BX.removeClass(c,"bx-selected"),c=e.clientHeight,e.style.overflow="hidden",BX.addClass(e,"bx-selected"),d=e.clientHeight,e.style.height=c+"px",(new BX.easing({duration:300,start:{height:c,opacity:0},finish:{height:d,opacity:100},transition:BX.easing.transitions.quad,step:function(g){e.style.height=g.height+"px"},complete:function(){e.removeAttribute("style")}})).animate(),b.setAttribute("value",a),this.maps&&this.maps.selectBalloon(a))},getDeliverySortedArray:function(a){var b=[],
c=[],d=function(f,g){var h=parseInt(f.SORT)-parseInt(g.SORT);return 0===h?f.OWN_NAME.toLowerCase()>g.OWN_NAME.toLowerCase()?1:f.OWN_NAME.toLowerCase()<g.OWN_NAME.toLowerCase()?-1:0:h},e;for(e in a)a.hasOwnProperty(e)&&("L"===this.params.SHOW_NOT_CALCULATED_DELIVERIES&&a[e].CALCULATE_ERRORS?c.push(a[e]):b.push(a[e]));b.sort(d);c.sort(d);return b.concat(c)},editPropsBlock:function(a){this.propsBlockNode&&this.propsHiddenBlockNode&&this.result.ORDER_PROP&&(a?this.editActivePropsBlock(!0):this.editFadePropsBlock(),
this.initialized.props=!0)},editActivePropsBlock:function(a){var b=a?this.propsBlockNode:this.propsHiddenBlockNode,c,d=!1,e;if(this.initialized.props)BX.remove(BX.lastChild(b)),b.appendChild(BX.firstChild(this.propsHiddenBlockNode)),this.maps&&setTimeout(BX.proxy(this.maps.propsMapFocusWaiter,this.maps),200);else{(a=b.querySelector(".bx-soa-section-content"))?BX.cleanNode(a):(a=this.getNewContainer(),b.appendChild(a));this.getErrorContainer(a);b=BX.create("DIV",{props:{className:"row"}});if((c=this.getSelectedDelivery())&&
"Y"===this.params.SHOW_MAP_IN_PROPS&&this.params.SHOW_MAP_FOR_DELIVERIES&&this.params.SHOW_MAP_FOR_DELIVERIES.length)for(e=0;e<this.params.SHOW_MAP_FOR_DELIVERIES.length;e++)if(parseInt(c.ID)===parseInt(this.params.SHOW_MAP_FOR_DELIVERIES[e])){d=!0;break}this.editPropsItems(b);d&&this.editPropsMap(b);"Y"!==this.params.HIDE_ORDER_DESCRIPTION&&this.editPropsComment(b);a.appendChild(b);this.getBlockFooter(a);"true"===this.propsBlockNode.getAttribute("data-visited")&&(a=this.isValidPropertiesBlock(!0),
a.length?BX.addClass(this.propsBlockNode,"bx-step-error"):BX.removeClass(this.propsBlockNode,"bx-step-error"))}},editFadePropsBlock:function(){var a=this.propsBlockNode.querySelector(".bx-soa-section-content");this.initialized.props?this.propsHiddenBlockNode.appendChild(a):(this.editActivePropsBlock(!1),BX.remove(BX.lastChild(this.propsBlockNode)));a=this.getNewContainer();this.propsBlockNode.appendChild(a);this.editFadePropsContent(a)},editFadePropsContent:function(a){if(a&&this.locationsInitialized){var b=
this.propsHiddenBlockNode.querySelector(".alert"),c=this.getSelectedPersonType(),d,e;BX.cleanNode(a);b&&a.appendChild(b.cloneNode(!0));if(c){var f="PROPS_FADE_LIST_"+c.ID;f=this.params[f]}if(f&&0!==f.length)for(b=this.fadedPropertyCollection.getGroupIterator();c=b();)for(d=c.getIterator();c=d();)for(e=0;e<f.length;e++)f[e]==c.getId()&&"Y"!=c.getSettings().IS_ZIP&&this.getPropertyRowNode(c,a,!0);else a.innerHTML+="<strong>"+BX.message("SOA_ORDER_PROPS")+"</strong>";"true"===this.propsBlockNode.getAttribute("data-visited")&&
(f=this.isValidPropertiesBlock(),f.length&&this.showError(this.propsBlockNode,f));BX.bind(a.querySelector(".alert.alert-danger"),"click",BX.proxy(this.showByClick,this));BX.bind(a.querySelector(".alert.alert-warning"),"click",BX.proxy(this.showByClick,this))}},editPropsItems:function(a){if(this.result.ORDER_PROP&&this.propertyCollection){var b=BX.create("UL",{props:{className:"bx-soa-customer profile__list form__wrapper"}}),c,d=this.propertyCollection.getGroupIterator(),e;for(b||=this.propsBlockNode.querySelector(".col-sm-12.bx-soa-customer");c=
d();)for(e=c.getIterator();c=e();)this.deliveryLocationInfo.loc!=c.getId()&&this.deliveryLocationInfo.zip!=c.getId()&&this.deliveryLocationInfo.city!=c.getId()&&this.getPropertyRowNode(c,b,!1);a.appendChild(b)}},getPropertyRowNode:function(a,b,c){var d=BX.create("LI"),e="",f=a.getType()||"",g=a.getDescription()||"";if(c)d.innerHTML="<strong>"+BX.util.htmlspecialchars(a.getName())+":</strong> ";else{BX.addClass(d,"form-group bx-soa-customer-field profile__item");a.isRequired()&&(e+='<span class="bx-authform-starrequired">*</span> ');
e+=BX.util.htmlspecialchars(a.getName());g.length&&"STRING"!=f&&"NUMBER"!=f&&"DATE"!=f&&(e="Y/N"!=f?e+(" <small>("+BX.util.htmlspecialchars(g)+")</small>"):`<span>${g}</span>`);var h=BX.create("LABEL",{attrs:{"for":"soa-property-"+a.getId()},props:{className:"bx-soa-custom-label label"},html:e});d.setAttribute("data-property-id-row",a.getId());"Y/N"!=f&&d.appendChild(h)}switch(f){case "LOCATION":this.insertLocationProperty(a,d,c);break;case "DATE":this.insertDateProperty(a,d,c);break;case "FILE":this.insertFileProperty(a,
d,c);break;case "STRING":this.insertStringProperty(a,d,c);break;case "ENUM":this.insertEnumProperty(a,d,c);break;case "Y/N":this.insertYNProperty(a,d,c);d.querySelector("DIV").appendChild(h);break;case "NUMBER":this.insertNumberProperty(a,d,c)}"STREET"==a.getSettings().CODE&&(b.appendChild(BX.create("LI",{props:{className:"propsprofile__item"},children:[BX.create("h4",{text:BX.message("SOA_ADDRESS_BLOCK")})]})),b.appendChild(BX.create("LI",{props:{className:"propsprofile__item profile__item--empty"}})));
b.appendChild(d);["SECONDNAME","AGREE1","AGREE2"].includes(a.getSettings().CODE)&&b.appendChild(BX.create("LI",{props:{className:"propsprofile__item profile__item--empty"}}))},insertLocationProperty:function(a,b,c){var d;var e=[];if(a.getId()in this.locations)if(c){if(d=this.propsHiddenBlockNode.querySelector('[data-property-id-row="'+a.getId()+'"]'))for(a=d.querySelectorAll("div.bx-soa-loc"),c=0;c<a.length;c++){var f=this.getLocationString(a[c]);e.push(f.length?BX.util.htmlspecialchars(f):BX.message("SOA_NOT_SELECTED"))}b.innerHTML+=
e.join("<br>")}else{var g=BX.create("DIV",{props:{className:"soa-property-container"}});d=this.locations[a.getId()];for(c=0;c<d.length;c++){e=d[c]?d[c].output:{};var h=BX.create("DIV",{props:{className:"bx-soa-loc"},html:e.HTML});a.isMultiple()&&(h.style.marginBottom="search"==this.locationsTemplate?"5px":"20px");g.appendChild(h);for(f in e.SCRIPT)e.SCRIPT.hasOwnProperty(f)&&BX.evalGlobal(e.SCRIPT[f].JS)}a.isMultiple()&&g.appendChild(BX.create("DIV",{attrs:{"data-prop-id":a.getId()},props:{className:"btn btn-sm btn-default"},
text:BX.message("ADD_DEFAULT"),events:{click:BX.proxy(this.addLocationProperty,this)}}));b.appendChild(g)}},addLocationProperty:function(a){a=a.target||a.srcElement;var b=a.getAttribute("data-prop-id"),c=BX.previousSibling(a),d,e=0,f=BX.util.getRandomString(5);BX.hasClass(c,"bx-soa-loc")&&("search"==this.locationsTemplate?(c=c.querySelector("input[type=text][class=dropdown-field]"))&&(e=parseInt(c.name.substring(c.name.indexOf("[")+1,c.name.indexOf("]")))+1):(c=c.querySelectorAll("input[type=hidden]"),
c.length&&(c=c[c.length-1],e=parseInt(c.name.substring(c.name.indexOf("[")+1,c.name.indexOf("]")))+1)));if(this.cleanLocations[b]){c=BX.create("DIV",{props:{className:"bx-soa-loc"},style:{marginBottom:"search"==this.locationsTemplate?"5px":"20px"},html:this.cleanLocations[b].HTML.split("#key#").join(e).replace(/sls-\d{5}/g,"sls-"+f)});a.parentNode.insertBefore(c,a);BX.saleOrderAjax.addPropertyDesc({id:b+"_"+e,attributes:{id:b+"_"+e,type:"LOCATION",valueSource:"form"}});for(d in this.cleanLocations[b].SCRIPT)this.cleanLocations[b].SCRIPT.hasOwnProperty(d)&&
BX.evalGlobal(this.cleanLocations[b].SCRIPT[d].JS.split("_key__").join("_"+e).replace(/sls-\d{5}/g,"sls-"+f));BX.saleOrderAjax.initDeferredControl()}},insertDateProperty:function(a,b,c){if(c){if(c=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){a=[];var d=c.querySelectorAll("input[type=text]");for(c=0;c<d.length;c++)d[c].value&&d[c].value.length&&a.push(d[c].value);b.innerHTML+=this.valuesToString(a)}}else{d=BX.create("DIV",{props:{className:"soa-property-container"}});
a.appendTo(d);b.appendChild(d);b=d.querySelectorAll("input[type=text]");for(c=0;c<b.length;c++)this.alterDateProperty(a.getSettings(),b[c]);this.alterProperty(a.getSettings(),d);this.bindValidation(a.getId(),d)}},insertFileProperty:function(a,b,c){var d;if(c){if(d=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){a=[];d=d.querySelectorAll("a");for(c=0;c<d.length;c++){var e=d[c].innerHTML;e.length&&a.push(e)}b.innerHTML+=this.valuesToString(a)}}else(c=this.savedFilesBlockNode.querySelector('div[data-property-id-row="'+
a.getId()+'"]'))&&(d=c.querySelector("div.soa-property-container")),d?b.appendChild(d):(d=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(d),b.appendChild(d),this.alterProperty(a.getSettings(),d))},insertStringProperty:function(a,b,c){var d;if(c){if(d=this.propsHiddenBlockNode.querySelector('[data-property-id-row="'+a.getId()+'"]')){c=[];a=d.querySelectorAll("input[type=text]");0==a.length&&(a=d.querySelectorAll("textarea"));if(a.length)for(d=0;d<a.length;d++)a[d].value.length&&
c.push(a[d].value);b.innerHTML+=this.valuesToString(c)}}else c=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(c),b.appendChild(c),this.alterProperty(a.getSettings(),c),this.bindValidation(a.getId(),c)},insertEnumProperty:function(a,b,c){var d;if(c){if(a=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){var e=[];c=a.querySelectorAll("input[type=radio]");if(c.length)for(d=0;d<c.length;d++)c[d].checked&&e.push(c[d].nextSibling.nodeValue);
c=a.querySelectorAll("option");if(c.length)for(d=0;d<c.length;d++)c[d].selected&&e.push(c[d].innerHTML);b.innerHTML+=this.valuesToString(e)}}else c=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(c),b.appendChild(c),this.bindValidation(a.getId(),c)},insertYNProperty:function(a,b,c){var d;if(c){if(c=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){a=[];c=c.querySelectorAll("input[type=checkbox]");for(d=0;d<c.length;d+=2)a.push(c[d].checked?
BX.message("SOA_YES"):BX.message("SOA_NO"));b.innerHTML+=this.valuesToString(a)}}else c=BX.create("DIV",{props:{className:"soa-property-container modal__check order__check"}}),a.appendTo(c),b.appendChild(c),this.alterProperty(a.getSettings(),c),this.bindValidation(a.getId(),c)},insertNumberProperty:function(a,b,c){var d;if(c){if(c=this.propsHiddenBlockNode.querySelector('div[data-property-id-row="'+a.getId()+'"]')){a=[];c=c.querySelectorAll("input[type=text]");for(d=0;d<c.length;d++)c[d].value.length&&
a.push(c[d].value);b.innerHTML+=this.valuesToString(a)}}else c=BX.create("DIV",{props:{className:"soa-property-container"}}),a.appendTo(c),b.appendChild(c),this.alterProperty(a.getSettings(),c),this.bindValidation(a.getId(),c)},valuesToString:function(a){a=a.join(", ");return a.length?BX.util.htmlspecialchars(a):BX.message("SOA_NOT_SELECTED")},alterProperty:function(a,b){var c=BX.findChildren(b,{tagName:"DIV"}),d;if(c&&c.length)for(d=0;d<c.length;d++)c[d].style.margin="5px 0";(d=b.querySelector("input[type=text]"))||
(d=b.querySelector("textarea"));d&&(d.id="soa-property-"+a.ID,"Y"==a.IS_ADDRESS&&d.setAttribute("autocomplete","address"),"Y"==a.IS_EMAIL&&d.setAttribute("autocomplete","email"),"Y"==a.IS_PAYER&&d.setAttribute("autocomplete","name"),"Y"==a.IS_PHONE&&d.setAttribute("autocomplete","tel"),a.PATTERN&&a.PATTERN.length&&d.removeAttribute("pattern"));c=b.querySelectorAll("input[type=text]");for(d=0;d<c.length;d++)c[d].placeholder=a.DESCRIPTION,BX.addClass(c[d],"form-control bx-soa-customer-input bx-ios-fix input");
c=b.querySelectorAll("select");for(d=0;d<c.length;d++)BX.addClass(c[d],"form-control");c=b.querySelectorAll("input[type=checkbox]");for(d=0;d<c.length;d++)BX.addClass(c[d],"input-action"),c[d].setAttribute("id","soa-property-"+a.ID);c=b.querySelectorAll("textarea");for(d=0;d<c.length;d++)c[d].placeholder=a.DESCRIPTION,BX.addClass(c[d],"form-control bx-ios-fix order__message");c=b.querySelectorAll("label");for(d=0;d<c.length;d++)BX.remove(c[d]);if("FILE"==a.TYPE){if(a.ACCEPT&&a.ACCEPT.length){c=b.querySelectorAll("input[type=file]");
var e=this.getFileAccepts(a.ACCEPT);for(d=0;d<c.length;d++)c[d].setAttribute("accept",e)}c=b.querySelectorAll("a");for(d=0;d<c.length;d++)BX.bind(c[d],"click",function(f){(f=(f=f.target||f.srcElement)&&f.nextSibling&&f.nextSibling.nextSibling)&&BX.fireEvent(f,"change")})}c=b.querySelectorAll("input[type=button]");for(d=0;d<c.length;d++)BX.addClass(c[d],"btn btn-default btn-sm"),"Y"==a.MULTIPLE&&d==c.length-1||"FILE"!=a.TYPE||(BX.prepend(c[d],c[d].parentNode),c[d].style.marginRight="10px");c.length&&
(c=c[c.length-1],BX.bind(c,"click",BX.delegate(function(f){f=BX.findParent(f.target||f.srcElement,{tagName:"div",className:"soa-property-container"});var g=f.querySelector("label"),h=f.querySelectorAll("input[type=button]"),k=f.querySelectorAll("input[type=text]"),l=f.querySelectorAll("textarea"),n=BX.findChildren(f,{tagName:"DIV"}),m;if(n&&n.length)for(m=0;m<n.length;m++)n[m].style.margin="5px 0";this.bindValidation(a.ID,f);h.length&&h[h.length-2]&&(BX.prepend(h[h.length-2],h[h.length-2].parentNode),
h[h.length-2].style.marginRight="10px",BX.addClass(h[h.length-2],"btn btn-default btn-sm"));g&&BX.remove(g);k.length&&(k[k.length-1].placeholder=a.DESCRIPTION,BX.addClass(k[k.length-1],"form-control bx-soa-customer-input bx-ios-fix"),"DATE"==a.TYPE&&this.alterDateProperty(a,k[k.length-1]),a.PATTERN&&a.PATTERN.length&&k[k.length-1].removeAttribute("pattern"));l.length&&(l[l.length-1].placeholder=a.DESCRIPTION,BX.addClass(l[l.length-1],"form-control bx-ios-fix"));if("FILE"==a.TYPE){if(a.ACCEPT&&a.ACCEPT.length)for(g=
b.querySelectorAll("input[type=file]"),h=this.getFileAccepts(a.ACCEPT),m=0;m<g.length;m++)g[m].setAttribute("accept",h);f=f.querySelectorAll("a");BX.bind(f[f.length-1],"click",function(p){var q=(p=p.target||p.srcElement)&&p.nextSibling&&p.nextSibling.nextSibling;q&&setTimeout(function(){BX.fireEvent(q,"change")},10)})}},this)))},alterDateProperty:function(a,b){var c=BX.findParent(b,{tagName:"DIV"});BX.addClass(c,"input-group");var d=BX.create("DIV",{props:{className:"input-group-addon"},children:[BX.create("I",
{props:{className:"bx-calendar"}})]});BX.insertAfter(d,b);BX.remove(c.querySelector("input[type=button]"));BX.bind(d,"click",BX.delegate(function(e){e=BX.findParent(e.target||e.srcElement,{tagName:"DIV",className:"input-group"});BX.calendar({node:e.querySelector(".input-group-addon"),field:e.querySelector("input[type=text]").name,form:"",bTime:"Y"==a.TIME,bHideTime:!1})},this))},isValidForm:function(){if(!this.options.propertyValidation)return!0;var a=this.isValidRegionBlock(),b=this.isValidPropertiesBlock(),
c=!1,d;a.length&&(c=!0,this.animateScrollTo(this.regionBlockNode,800,50));if(b.length&&!c)if(this.activeSectionId==this.propsBlockNode.id)for(c=this.propsBlockNode.querySelectorAll("div.tooltip"),d=0;d<c.length;d++){if("opened"==c[d].getAttribute("data-state")){this.animateScrollTo(BX.findParent(c[d],{className:"form-group bx-soa-customer-field"}),800,50);break}}else this.animateScrollTo(this.propsBlockNode,800,50);a.length&&(this.showError(this.regionBlockNode,a),BX.addClass(this.regionBlockNode,
"bx-step-error"));b.length&&(this.activeSectionId!==this.propsBlockNode.id&&this.showError(this.propsBlockNode,b),BX.addClass(this.propsBlockNode,"bx-step-error"));return!(a.length+b.length)},isValidRegionBlock:function(){if(!this.options.propertyValidation)return[];var a=this.orderBlockNode.querySelectorAll(".bx-soa-location-input-container[data-property-id-row]"),b=[],c;for(c=0;c<a.length;c++){var d=a[c].getAttribute("data-property-id-row");d=this.validation.properties[d];d=this.getValidationData(d,
a[c]);b=b.concat(this.isValidProperty(d,!0))}return b},isValidPropertiesBlock:function(a){if(!this.options.propertyValidation)return[];var b=this.orderBlockNode.querySelectorAll(".bx-soa-customer-field[data-property-id-row]"),c=[],d,e;for(e=0;e<b.length;e++){var f=b[e].getAttribute("data-property-id-row");if(!a||!this.locations[f])if(d=b[e].querySelector(".soa-property-container"))f=this.validation.properties[f],d=this.getValidationData(f,d),c=c.concat(this.isValidProperty(d,!0))}return c},isValidProperty:function(a,
b){var c=[],d;if(!a||!a.inputs)return c;for(d=0;d<a.inputs.length;d++){var e=a.func(a.inputs[d],!!b);e.length&&(c[d]=e.join("<br>"))}this.showValidationResult(a.inputs,c);return c},bindValidation:function(a,b){if(this.validation.properties&&this.validation.properties[a]){var c=this.getValidationData(this.validation.properties[a],b);if(c&&c.inputs&&c.action)for(a=0;a<c.inputs.length;a++)if(BX.type.isElementNode(c.inputs[a]))BX.bind(c.inputs[a],c.action,BX.delegate(function(){this.isValidProperty(c)},
this));else for(b=0;b<c.inputs[a].length;b++)BX.bind(c.inputs[a][b],c.action,BX.delegate(function(){this.isValidProperty(c)},this))}},getValidationData:function(a,b){if(a&&b){var c={};switch(a.TYPE){case "STRING":c.action="change";c.func=BX.delegate(function(e,f){return this.validateString(e,a,f)},this);var d=b.querySelectorAll("input[type=text]");if(d.length){c.inputs=d;break}d=b.querySelectorAll("textarea");d.length&&(c.inputs=d);break;case "LOCATION":c.func=BX.delegate(function(e,f){return this.validateLocation(e,
a,f)},this);d=b.querySelectorAll("input.bx-ui-sls-fake[type=text]");if(d.length){c.inputs=d;c.action="keyup";break}d=b.querySelectorAll("div.bx-ui-slst-pool");d.length&&(c.inputs=d);break;case "Y/N":c.inputs=b.querySelectorAll("input[type=checkbox]");c.action="change";c.func=BX.delegate(function(e,f){return this.validateCheckbox(e,a,f)},this);break;case "NUMBER":c.inputs=b.querySelectorAll("input[type=text]");c.action="blur";c.func=BX.delegate(function(e,f){return this.validateNumber(e,a,f)},this);
break;case "ENUM":d=b.querySelectorAll("input[type=radio]");d.length||(d=b.querySelectorAll("input[type=checkbox]"));if(d.length){c.inputs=[d];c.action="change";c.func=BX.delegate(function(e,f){return this.validateEnum(e,a,f)},this);break}d=b.querySelectorAll("option");d.length&&(c.inputs=[d],c.action="click",c.func=BX.delegate(function(e,f){return this.validateSelect(e,a,f)},this));break;case "FILE":c.inputs=b.querySelectorAll("input[type=file]");c.action="change";c.func=BX.delegate(function(e,f){return this.validateFile(e,
a,f)},this);break;case "DATE":c.inputs=b.querySelectorAll("input[type=text]"),c.action="change",c.func=BX.delegate(function(e,f){return this.validateDate(e,a,f)},this)}return c}},showErrorTooltip:function(a,b,c){if(a&&b&&c){var d=BX("tooltip-"+a);c=this.uniqueText(c,"<br>");if(d)var e=d.querySelector("div.tooltip-inner");else e=BX.create("DIV",{props:{className:"tooltip-inner"}}),d=BX.create("DIV",{props:{id:"tooltip-"+a,className:"bx-soa-tooltip bx-soa-tooltip-static bx-soa-tooltip-danger tooltip top"},
children:[BX.create("DIV",{props:{className:"tooltip-arrow"}}),e]}),(a=b.parentNode.querySelector("div.quick-locations"))&&(b=a),BX.insertAfter(d,b);e.innerHTML=c;"opened"!=d.getAttribute("data-state")&&(d.setAttribute("data-state","opened"),d.style.opacity=0,d.style.display="block",(new BX.easing({duration:150,start:{opacity:0},finish:{opacity:100},transition:BX.easing.transitions.quad,step:function(f){d.style.opacity=f.opacity/100}})).animate())}},closeErrorTooltip:function(a){var b=BX("tooltip-"+
a);b&&(b.setAttribute("data-state","closed"),(new BX.easing({duration:150,start:{opacity:100},finish:{opacity:0},transition:BX.easing.transitions.quad,step:function(c){b.style.opacity=c.opacity/100},complete:function(){b.style.display="none"}})).animate())},showValidationResult:function(a,b){if(a&&a.length&&b){var c=BX.type.isElementNode(a[0])?a[0]:a[0][0],d=BX.findParent(c,{tagName:"LI",className:"form-group"});d=d?d:BX.findParent(c,{tagName:"DIV",className:"form-group"});(c=d.querySelector("label"))&&
c.getAttribute("for");for(c=0;c<a.length;c++)b[c]&&b[c].length&&BX.addClass(a[c],"error_input")}},validateString:function(a,b,c){if(!a||!b)return[];var d=a.value,e=[],f=BX.util.htmlspecialchars(b.NAME);c=c?BX.message("SOA_FIELD")+' "'+f+'"':BX.message("SOA_FIELD");if("Y"===b.MULTIPLE)return e;"Y"===b.REQUIRED&&0===d.length&&e.push(c+" "+BX.message("SOA_REQUIRED"));d.length&&(b.MINLENGTH&&b.MINLENGTH>d.length&&e.push(BX.message("SOA_MIN_LENGTH")+' "'+f+'" '+BX.message("SOA_LESS")+" "+b.MINLENGTH+" "+
BX.message("SOA_SYMBOLS")),b.MAXLENGTH&&b.MAXLENGTH<d.length&&e.push(BX.message("SOA_MAX_LENGTH")+' "'+f+'" '+BX.message("SOA_MORE")+" "+b.MAXLENGTH+" "+BX.message("SOA_SYMBOLS")),"Y"===b.IS_EMAIL&&(a.value=d=BX.util.trim(d),d.length&&(a=/^(([^<>()[\]\.,;:\s@"]+(\.[^<>()[\]\.,;:\s@"]+)*)|(".+"))@(([^<>()[\]\.,;:\s@"]+\.)+[^<>()[\]\.,;:\s@"]{2,})$/i,a.test(d)||e.push(BX.message("SOA_INVALID_EMAIL")))),0<d.length&&b.PATTERN&&b.PATTERN.length&&(a=new RegExp(b.PATTERN),a.test(d)||e.push(c+" "+BX.message("SOA_INVALID_PATTERN"))));
return e},validateLocation:function(a,b,c){if(!a||!b)return[];a=BX.findParent(a,{tagName:"DIV",className:"form-group"});a=this.getLocationString(a);var d=[];c=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");if("Y"==b.MULTIPLE&&"Y"!==b.IS_LOCATION)return d;"Y"!=b.REQUIRED||0!=a.length&&a!=BX.message("SOA_NOT_SPECIFIED")||d.push(c+" "+BX.message("SOA_REQUIRED"));return d},validateCheckbox:function(a,b,c){if(!a||!b)return[];var d=[];c=c?BX.message("SOA_FIELD")+
' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");if("Y"==b.MULTIPLE)return d;"Y"!=b.REQUIRED||a.checked||d.push(c+" "+BX.message("SOA_REQUIRED"));return d},validateNumber:function(a,b,c){if(!a||!b)return[];var d=a.value;a=[];var e=BX.util.htmlspecialchars(b.NAME);c=c?BX.message("SOA_FIELD")+' "'+e+'"':BX.message("SOA_FIELD");if("Y"==b.MULTIPLE)return a;"Y"==b.REQUIRED&&0==d.length&&a.push(c+" "+BX.message("SOA_REQUIRED"));d.length&&(/[0-9]|\./.test(d)||a.push(c+" "+BX.message("SOA_NOT_NUMERIC")),
b.MIN&&parseFloat(b.MIN)>parseFloat(d)&&a.push(BX.message("SOA_MIN_VALUE")+' "'+e+'" '+parseFloat(b.MIN)),b.MAX&&parseFloat(b.MAX)<parseFloat(d)&&a.push(BX.message("SOA_MAX_VALUE")+' "'+e+'" '+parseFloat(b.MAX)),b.STEP&&0<parseFloat(b.STEP)&&(d=Math.abs(parseFloat(d)-(b.MIN&&0<parseFloat(b.MIN)?parseFloat(b.MIN):0)),d=(d/parseFloat(b.STEP)).toPrecision(12),d!=parseInt(d)&&a.push(c+" "+BX.message("SOA_NUM_STEP")+" "+b.STEP)));return a},validateEnum:function(a,b,c){if(!a||!b)return[];var d=[],e=[],
f=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");if("Y"==b.MULTIPLE)return e;for(c=0;c<a.length;c++)(a[c].checked||a[c].selected)&&d.push(c);"Y"==b.REQUIRED&&0==d.length&&e.push(f+" "+BX.message("SOA_REQUIRED"));return e},validateSelect:function(a,b,c){if(!a||!b)return[];var d=[],e=[],f=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");if("Y"==b.MULTIPLE)return e;for(c=0;c<a.length;c++)a[c].selected&&d.push(c);
"Y"==b.REQUIRED&&0==d.length&&e.push(f+" "+BX.message("SOA_REQUIRED"));return e},validateFile:function(a,b,c){if(!a||!b)return[];var d=[],e=a.files||[];c=c?BX.message("SOA_FIELD")+' "'+BX.util.htmlspecialchars(b.NAME)+'"':BX.message("SOA_FIELD");a=a.previousSibling.value;if("Y"==b.MULTIPLE)return d;if("Y"!=b.REQUIRED||0!=e.length||""!=a||b.DEFAULT_VALUE&&b.DEFAULT_VALUE.length)for(a=0;a<e.length;a++){c=e[a];var f=BX.util.htmlspecialchars(c.name);var g=c.name.split(".");g=1<g.length?g[g.length-1].toLowerCase():
"";0<b.ACCEPT.length&&(0==g.length||"-1"==b.ACCEPT.indexOf(g))&&d.push(BX.message("SOA_BAD_EXTENSION")+' "'+f+'" ('+BX.util.htmlspecialchars(b.ACCEPT)+")");c.size>parseInt(b.MAXSIZE)&&d.push(BX.message("SOA_MAX_SIZE")+' "'+f+'" ('+this.getSizeString(b.MAXSIZE,1)+")")}else d.push(c+" "+BX.message("SOA_REQUIRED"));return d},validateDate:function(a,b,c){if(!a||!b)return[];a=a.value;var d=[],e=BX.util.htmlspecialchars(b.NAME);c=c?BX.message("SOA_FIELD")+' "'+e+'"':BX.message("SOA_FIELD");if("Y"==b.MULTIPLE)return d;
"Y"==b.REQUIRED&&0==a.length&&d.push(c+" "+BX.message("SOA_REQUIRED"));return d},editPropsMap:function(a){var b=BX.create("DIV",{props:{className:"col-sm-12"},style:{marginBottom:"10px"}}),c=BX.create("DIV",{props:{id:"propsMap"},style:{width:"100%"}});b.appendChild(c);a.appendChild(b)},editPropsComment:function(a){var b=BX.create("DIV",{props:{className:"order__block mt-40"}});var c=BX.create("TEXTAREA",{props:{id:"orderDescription",cols:"4",className:"form-control bx-soa-customer-textarea bx-ios-fix input order__message",
name:"ORDER_DESCRIPTION",placeholder:this.params.MESS_ORDER_DESC},text:this.result.ORDER_DESCRIPTION?this.result.ORDER_DESCRIPTION:""});c=BX.create("DIV",{props:{className:"form-group bx-soa-customer-field"},children:[c]});b.appendChild(c);a.appendChild(b)},editTotalBlock:function(){if(this.totalInfoBlockNode&&this.result.TOTAL){var a=this.result.TOTAL,b={},c,d="Y"===this.params.SHOW_TOTAL_ORDER_BUTTON;BX.cleanNode(this.totalInfoBlockNode);if(0===parseFloat(a.ORDER_PRICE)){var e=this.params.MESS_PRICE_FREE;
b.free=!0}else e=a.ORDER_PRICE_FORMATED;this.options.showPriceWithoutDiscount&&(e+='<br><span class="bx-price-old">'+a.PRICE_WITHOUT_DISCOUNT+"</span>");this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_SUMMARY"),e,b));this.options.showOrderWeight&&this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_WEIGHT_SUM"),a.ORDER_WEIGHT_FORMATED));if(this.options.showTaxList)for(e=0;e<a.TAX_LIST.length;e++)b=a.TAX_LIST[e].VALUE_MONEY_FORMATED||"",this.totalInfoBlockNode.appendChild(this.createTotalUnit(a.TAX_LIST[e].NAME+
(a.TAX_LIST[e].VALUE_FORMATED?" "+a.TAX_LIST[e].VALUE_FORMATED:"")+":",b));b={};if(c=(e=this.getSelectedDelivery())&&e.CALCULATE_ERRORS&&e.CALCULATE_ERRORS.length){var f=BX.message("SOA_NOT_CALCULATED");b.error=c}else 0===parseFloat(a.DELIVERY_PRICE)?(f=this.params.MESS_PRICE_FREE,b.free=!0):f=a.DELIVERY_PRICE_FORMATED,e&&"undefined"!==typeof e.DELIVERY_DISCOUNT_PRICE&&parseFloat(e.PRICE)>parseFloat(e.DELIVERY_DISCOUNT_PRICE)&&(f+='<br><span class="bx-price-old">'+e.PRICE_FORMATED+"</span>");this.result.DELIVERY.length&&
this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_DELIVERY"),f,b));this.options.showDiscountPrice&&(b=this.params.MESS_ECONOMY,a.DISCOUNT_PERCENT_FORMATED&&0<parseFloat(a.DISCOUNT_PERCENT_FORMATED)&&(b+=a.DISCOUNT_PERCENT_FORMATED),this.totalInfoBlockNode.appendChild(this.createTotalUnit(b+":",a.DISCOUNT_PRICE_FORMATED,{highlighted:!0})));this.options.showPayedFromInnerBudget?(this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_IT"),a.ORDER_TOTAL_PRICE_FORMATED)),
this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_PAYED"),a.PAYED_FROM_ACCOUNT_FORMATED)),this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_LEFT_TO_PAY"),a.ORDER_TOTAL_LEFT_TO_PAY_FORMATED,{total:!0}))):this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_SUM_IT"),a.ORDER_TOTAL_PRICE_FORMATED,{total:!0}));0<=parseFloat(a.PAY_SYSTEM_PRICE)&&this.result.DELIVERY.length&&this.totalInfoBlockNode.appendChild(this.createTotalUnit(BX.message("SOA_PAYSYSTEM_PRICE"),
"~"+a.PAY_SYSTEM_PRICE_FORMATTED));this.result.SHOW_AUTH||((a=document.querySelector(".bx-soa-cart-total-button-container"))&&a.remove(),this.totalBlockNode.appendChild(BX.create("DIV",{props:{className:"bx-soa-cart-total-button-container"+(d?"":" visible-xs")},children:[BX.create("A",{props:{href:"javascript:void(0)",className:"btn btn--red btn--icn btn--l order-btn btn-order-save"},html:`<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.5 9V8C17.5 5.2385 15.2615 3 12.5 3C9.7385 3 7.5 5.2385 7.5 8V9H4.5C3.94772 9 3.5 9.44772 3.5 10V18C3.5 19.6575 4.8425 21 6.5 21H18.5C20.1575 21 21.5 19.6575 21.5 18V10C21.5 9.44772 21.0523 9 20.5 9H17.5ZM9.5 8C9.5 6.34325 10.8433 5 12.5 5C14.1567 5 15.5 6.34325 15.5 8V9H9.5V8ZM19.5 18C19.5 18.5525 19.0525 19 18.5 19H6.5C5.9475 19 5.5 18.5525 5.5 18V11H19.5V18Z" fill="white"></path>
                    </svg><span>${this.params.MESS_ORDER}</span>`,events:{click:BX.proxy(this.clickOrderSaveAction,this)}})]})));this.editMobileTotalBlock()}},editMobileTotalBlock:function(){this.result.SHOW_AUTH?BX.removeClass(this.mobileTotalBlockNode,"visible-xs"):BX.addClass(this.mobileTotalBlockNode,"visible-xs");BX.cleanNode(this.mobileTotalBlockNode);this.mobileTotalBlockNode.appendChild(this.totalInfoBlockNode.cloneNode(!0));BX.bind(this.mobileTotalBlockNode.querySelector("a.bx-soa-price-not-calc"),
"click",BX.delegate(function(){this.animateScrollTo(this.deliveryBlockNode)},this));BX.bind(this.mobileTotalBlockNode.querySelector("a.btn-order-save"),"click",BX.proxy(this.clickOrderSaveAction,this))},createTotalUnit:function(a,b,c){var d="bx-soa-cart-total-line aside-box__item",e="",f="";a=a||"";b=b||"";c=c||{};b=c.error?[BX.create("A",{props:{className:"bx-soa-price-not-calc"},html:b,events:{click:BX.delegate(function(){this.animateScrollTo(this.deliveryBlockNode)},this)}})]:c.free?[BX.create("SPAN",
{props:{className:"bx-soa-price-free"},html:b})]:[b];c.total&&(d+=" bx-soa-cart-total-line-total",e=" strong",f=" strong total-price");c.highlighted&&(d+=" bx-soa-cart-total-line-highlighted");return BX.create("LI",{props:{className:d},children:[BX.create("SPAN",{props:{className:"bx-soa-cart-t aside-box__text"+e},text:a}),BX.create("SPAN",{props:{className:"bx-soa-cart-d aside-box__text"+f+(c.total&&this.options.totalPriceChanged?" bx-soa-changeCostSign":"")},children:b})]})},basketBlockScrollCheckEvent:function(a){var b=
a.target||a.srcElement;a=b.scrollLeft;var c=b.scrollWidth-(a+b.clientWidth);b=b.parentNode;0==a?BX.removeClass(b,"bx-soa-table-fade-left"):BX.addClass(b,"bx-soa-table-fade-left");0==c?BX.removeClass(b,"bx-soa-table-fade-right"):BX.addClass(b,"bx-soa-table-fade-right")},basketBlockScrollCheck:function(){var a=this.orderBlockNode.querySelectorAll("div.bx-soa-table-fade"),b,c=!1;for(b=0;b<a.length;b++){var d=a[b];var e=d.querySelector("div.bx-soa-item-table");var f=d.clientWidth;e=e.clientWidth||0;(c=
c||e>f)?(e=BX.firstChild(d),f=e.scrollLeft,e=e.scrollWidth-(f+e.clientWidth),0==f?BX.removeClass(d,"bx-soa-table-fade-left"):BX.addClass(d,"bx-soa-table-fade-left"),0==e?BX.removeClass(d,"bx-soa-table-fade-right"):BX.addClass(d,"bx-soa-table-fade-right"),0==f&&0==e&&BX.addClass(d,"bx-soa-table-fade-right")):BX.removeClass(d,"bx-soa-table-fade-left bx-soa-table-fade-right")}},totalBlockScrollCheck:function(){if(this.totalInfoBlockNode&&this.totalGhostBlockNode){var a=BX.GetWindowScrollPos().scrollTop,
b=BX.pos(this.totalGhostBlockNode).top;BX.pos(this.orderBlockNode).bottom-this.totalBlockNode.offsetHeight<a+20?BX.addClass(this.totalInfoBlockNode,"bx-soa-cart-total-bottom"):BX.removeClass(this.totalInfoBlockNode,"bx-soa-cart-total-bottom");a>b&&!BX.hasClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed")?(a=this.totalInfoBlockNode.offsetWidth,BX.addClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed"),this.totalGhostBlockNode.style.paddingTop=this.totalInfoBlockNode.offsetHeight+"px",this.totalInfoBlockNode.style.width=
a+"px"):a<b&&BX.hasClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed")&&(BX.removeClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed"),this.totalGhostBlockNode.style.paddingTop=0,this.totalInfoBlockNode.style.width="")}},totalBlockResizeCheck:function(){this.totalInfoBlockNode&&this.totalGhostBlockNode&&BX.hasClass(this.totalInfoBlockNode,"bx-soa-cart-total-fixed")&&(this.totalInfoBlockNode.style.width=this.totalGhostBlockNode.offsetWidth+"px")},totalBlockFixFont:function(){var a=this.totalInfoBlockNode.querySelector(".bx-soa-cart-total-line.bx-soa-cart-total-line-total"),
b=[];a&&(a=BX.lastChild(a),b.push({node:a,maxFontSize:28,smallestValue:!1,scaleBy:a.parentNode}));"Y"==this.params.SHOW_TOTAL_ORDER_BUTTON&&(a=this.totalInfoBlockNode.querySelector(".bx-soa-cart-total-button-container"))&&(a=BX.lastChild(a),b.push({node:a,maxFontSize:18,smallestValue:!1}));b.length&&BX.FixFontSize.init({objList:b,onAdaptiveResize:!0})},setAnalyticsDataLayer:function(a,b){if(this.params.DATA_LAYER_NAME){var c,d=[];for(c in this.result.GRID.ROWS)if(this.result.GRID.ROWS.hasOwnProperty(c)){var e=
this.result.GRID.ROWS[c];var f=[];for(c=0;c<e.data.PROPS.length;c++)f.push(e.data.PROPS[c].VALUE);d.push({id:e.data.PRODUCT_ID,name:e.data.NAME,price:e.data.PRICE,brand:(e.data[this.params.BRAND_PROPERTY+"_VALUE"]||"").split(", ").join("/"),variant:f.join("/"),quantity:e.data.QUANTITY})}switch(a){case "checkout":var g={event:"checkout",ecommerce:{checkout:{products:d}}};break;case "purchase":g={event:"purchase",ecommerce:{purchase:{actionField:{id:b,revenue:this.result.TOTAL.ORDER_TOTAL_PRICE,tax:this.result.TOTAL.TAX_PRICE,
shipping:this.result.TOTAL.DELIVERY_PRICE},products:d}}}}window[this.params.DATA_LAYER_NAME]=window[this.params.DATA_LAYER_NAME]||[];window[this.params.DATA_LAYER_NAME].push(g)}},isOrderSaveAllowed:function(){return!0===this.orderSaveAllowed},allowOrderSave:function(){this.orderSaveAllowed=!0},disallowOrderSave:function(){this.orderSaveAllowed=!1},initUserConsent:function(){BX.ready(BX.delegate(function(){var a=BX.UserConsent&&BX.UserConsent.load(this.orderBlockNode);a&&(BX.addCustomEvent(a,BX.UserConsent.events.save,
BX.proxy(this.doSaveAction,this)),BX.addCustomEvent(a,BX.UserConsent.events.refused,BX.proxy(this.disallowOrderSave,this)))},this))}}})();setTimeout(function(){SC.setErrorsEvent()},1500);
